<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>二.程序的机器级表示(CSAPP) | Yeelight の 小屋</title>
<meta name=keywords content="CSAPP"><meta name=description content="#入门 微处理器历史 Intel的x86 在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的深入研究，如果"><meta name=author content="Yeelight"><link rel=canonical href=https://yeekox.netlify.app/zh-cn/posts/csapp02/><link crossorigin=anonymous href=/assets/css/stylesheet.07364e0d4070e21e3f3be5df749408d0117f6cf8d160730a29fb57ae6f237381.css integrity="sha256-BzZODUBw4h4/O+XfdJQI0BF/bPjRYHMKKftXrm8jc4E=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://yeekox.netlify.app/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://yeekox.netlify.app/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://yeekox.netlify.app/favicon-32x32.png><link rel=apple-touch-icon href=https://yeekox.netlify.app/apple-touch-icon.png><link rel=mask-icon href=https://yeekox.netlify.app/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css integrity=sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js integrity=sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><meta property="og:title" content="二.程序的机器级表示(CSAPP)"><meta property="og:description" content="#入门 微处理器历史 Intel的x86 在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的深入研究，如果"><meta property="og:type" content="article"><meta property="og:url" content="https://yeekox.netlify.app/zh-cn/posts/csapp02/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-09T20:13:06+08:00"><meta property="article:modified_time" content="2023-04-09T20:13:06+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="二.程序的机器级表示(CSAPP)"><meta name=twitter:description content="#入门 微处理器历史 Intel的x86 在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的深入研究，如果"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://yeekox.netlify.app/zh-cn/posts/"},{"@type":"ListItem","position":2,"name":"二.程序的机器级表示(CSAPP)","item":"https://yeekox.netlify.app/zh-cn/posts/csapp02/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"二.程序的机器级表示(CSAPP)","name":"二.程序的机器级表示(CSAPP)","description":"#入门 微处理器历史 Intel的x86 在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的深入研究，如果","keywords":["CSAPP"],"articleBody":"#入门\n微处理器历史 Intel的x86 在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的深入研究，如果有任何的错误请告诉我，谢谢。\n自从1971年的Intel4004既第一款微处理器，也是全球第一款微处理器开始，我们人类社会标志着进入微芯片时代，在这个时代有三个主要的趋势：\n处理器的位长的倍增 指令集的快速发展 时钟频率的快速增加 Intel也逐步发布了Intel 8008一个8位的，Intel 8086 一个16位的，至此，Intel的x86帝国开始了。在1985年，Intel的32位处理器IA32问世，而随着摩尔定律等的种种限制，单核的处理器已经遇到瓶颈了，各大公司继而转向了高频率、低功耗的多核处理器，处理器进入多核/多线程时代（2005）。\n在一些无论是竞争关系，还是研究关系，导致目前的市场上出现了两种指令集计算机\nCISC(Complex instruction set computer) RISC(Reduced instruction set computer) 在后面我会再提到的。\n我不知道未来的处理器向哪个方向发展，也不知道Intel是否一直在前沿（AMD：呵呵），但我相信，人类的智慧使得世界自第二次工业革命以来史无前例的大发展，在未来一定有着不一样的发展。\n基本概念 嗯嗯，回来回来，不去想未来，做好当下。\n在了解具体的体系系统前，我们来了解基本的一些东西：\n上面是来自CS61c的图片，我们现在要了解就是整个软件到硬件的过程，也可以说是抽象到具体的过程。\nInstructure Set Architecture：指令集架构 (包括指令规格，不同规则寄存器等)，简称ISA，它是软硬件之间的桥梁。\nProcessor、Memory、I/O system：这是由OS进行控制的。\n我们这章主要的是学习ISA，CSAPP主要是x86-64的CISC指令集，CS61c主要是RISC-V的RISC指令集，没错，它们是不同的指令集，在我的笔记里面我也会不时的写上RISC-V的一些表示来证明我学习过了（笑）。\n什么是编译 1 2 高级语言 --\u003e 汇编语言 --\u003e 机器语言 在我们的零章的时候我说过一个*.c文件如何变成的一个可执行的程序的一个主要过程，它有一个步骤是编译，这是一个我们需要细细品味的步骤。\n编译过程是一个由某个高级语言（比如c文件）经过编译器的一系列的处理成为可读性低的汇编语言。换而言之，就是把我们十分清楚明白的抽象语言转换成机器语言（值得注意的是，此时机器也不知道汇编语言），在经历汇编译器翻译成二进制代码，真正的机器语言，机器可以读懂了，但我们看不懂（除了某些黑客）。\n上面是cs61c中的从C到机器语言的完整过程，十分的详细了。程序的运行就是想像是一个翻译过程，用上一些我们明文规定的语法规则，使用编译器（GCC等）来当我们程序员和机器之间的翻译官。\n现在来看一看从 C语言 到机器代码(一个整型加法计算的汇编代码)\n1 2 3 4 5 6 7 8 9 10 11 12 // filename: clcyle_one #include int main(int argc, char const *argv[]) { int sum = 0; for (int i = 0; i \u003c 10; ++i) { sum += i; } return 0; } 经过gcc的编译，在自己的Linux机器上使用以下的代码\n1 $ gcc -Og -S clcyle_one.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 .file \"clcyle_one.c\" .text .globl main .type main, @function main: .LFB7: .cfi_startproc movl $0, %eax jmp .L2 .L3: addl $1, %eax .L2: cmpl $9, %eax jle .L3 movl $0, %eax ret #（不用在意类似 .file 的指令，它们是伪指令， 要从main看起） 两者相互比较一下我们可以发现，C 语言代码被处理成统一格式的汇编代码，在汇编代码中，第一个字符串叫做操作符，后面的是源和目的寄存器（这是一个大玩意😣）。操作和操作数明确，在下面我们会到不同的操作符分类分析（我想把RISC-V的加入作比较），记住一个条件，读取/运算操作是一个线性逐句逐次的操作，PC指令是有现态和次态之分。\n处理器的工作 在我们对操作指令分类讨论之前我们来认识处理器是怎么工作的，\n上面的图片(分别来自CSapp和CS61c)十分清楚的展示了处理器对于存放在主存里面的指令有着什么样的操作，主要的就两点存、读取值和计算。在x86-64里面还有一个叫作条件码的东东，我会在下面说到因为我也第一次看见这个。\n这是一个CPU到Memory的一个过程，具体的是一个处理器从内存某个地址取值（有数据和指令）拿到CPU里的寄存器通过ALU计算，再根据PC选择下一步。\n程序计数器(PC, Program counter) - 存着下一条指令的地址，在 x86-64 中称为 RIP。\n寄存器(Register) - 用来存储数据以便操作。\n条件代码(Codition codes) - 通常保存最近的算术或逻辑操作后的信息，用来做条件跳转的条件。\n什么是ISA Instruction Set Architecture (指令集框架) 是包含了针对某个特定处理器执行的基本操作码（opcode），里面是基本命令，在我们学习的x86-64、RISC-V都有不同的ISA。\n为了学习方便，我们一般要把ISA根据使用的方法不同进行不同的分类。\n资料处理与访问操作 算术逻辑操作 控制过程操作 在下面我会一一分析。\nCISC\u0026RISC区别 CISC(Complex instruction set computer)\n兼容性性强，指令繁多，长度可变，由微程序实现。 代表：x86-64\nRISC(Reduced instruction set computer)\n指令少，使用频率接近，主要是依靠硬件实现（通用寄存器、硬布线逻辑控制）。 代表：RISC-V\n开始快乐的汇编 整型寄存器 在x86-64上有16个64位的通用寄存器；对于每个寄存器的低32、16和8位可以独立地通过其他不同指令名称访问，原则上，几乎任何寄存器都可以用于保存几乎任何逻辑和算术操作的操作数，但有些具有特殊或受限制的用途。\n一个寄存器有着64位、32位、16位、8位这可以对以前的低位程序向下兼容。\n按照惯例，%rsp被保留作为堆栈指针，并且因为一些指令（例如push、pop、call）隐含使用它。%rsp指向最低占用的堆栈位置（而不是下一个要使用的位置）。\n寄存器%rbp有时被用作帧指针，即当前堆栈帧的基址。指令计数器寄存器（％rip） 指向要执行的下一条命令; 程序员无法直接访问它, 但是大量地被用作基于位置无关代码寻址的基础。还有一些其他指令隐含地使用某些寄存器；例如，整数乘法和除法指令需要%rax和%rdx。\n数据类型 既然我们的寄存器有着不同位的表示，那就是说处理器在操作不同的数据时使用着不同位数的寄存器来提高速率。\n我们针对不同的数据类型使用不同的suffix和size：\nData type suffix size word char b 1B Byet short w 2B 1word int l 4B 2word long q 8B 4word char* q 8B 4word float s 4B 2word double l 8B 4word 上面的suffix列显示了在 GNU 汇编程序用来指定适当大小的变体的字母指示。\n而一个新单位word是相等于2个字节的大小。\n操作数指示符 操作数基本 以下的都是在操作数里面主要数值表达的意思：\nImm refers to a constant value, e.g. 0x8048d8e or 48 r refers to a register. e.g. %rax or %edi R[r] refers to the value stored in register address r. M[i] refers to the value stored at memory address i . 不同的格式表示不同的类型。\n寻址 很重要！！！\n对于寻址来说，比较通用的格式是：Imm(Rb, Ri, S) -\u003e M[R[Rb] + S*R[Ri]+ Imm]，其中：\nImm - 常数偏移量 Rb - 基寄存器 Ri - 索引寄存器，不能是 %rsp S - 系数 指令 接下来我们就来看看不同分类的指令格式，我按书上的顺序来说的，它也是按我们在平时使用的频率顺序来教的。\n大多数的指令都是使用上文提过的 suffix 来显示操作数的大小的。\n数据移动指令 对于 mov 指令来说，需要源操作数和目标操作数。指令的具体格式可以这样写 mov? Src, Dest，第一个是源操作数，第二个是目标操作数\n1 2 3 4 5 6 mov[b|w|l|q] Src, Dest # 将src移动到dest movs[bw|bl|bq|wl|wq|lq] Src, Dest # 带符号扩展的移动 movz[bw|bl|bq|wl|wq] Src, Dest # 带零扩展的移动 movabsq imm, r # 移动绝对四字（imm为64位） cltq Src, Dest # 把%eax 符号扩展到%rax 在使用 mov 指令的时候需要值得注意的是我们的源值和目的值的选址是有标准的, 源操作数可以是立即数、寄存器值或内存值的任意一种，但目标操作数只能是寄存器值或内存值\nSrc Dest imm Rag imm Mem Reg Reg Reg Mem Mem Reg 只有这五种的选择 ， 如果要把Mem -\u003e Mem 的值移动，需要两步 Mem -\u003e Reg -\u003e Mem\n程序栈指令 这一部分就只有两个主要的指令，但是无比的重要。可以把数据压入程序栈中，以及在栈中弹出，程序栈在过程调用中起至关重要的作用。\n1 2 pushq Src # 将4word的数据压入栈，并把%rsp - 8 -\u003e %rsp popq Dest # 将4word的数据弹入栈，并把%rsp + 8 -\u003e %rsp 对于程序栈指令十分重要的一点是我们对内存的变化要注意。在程序员的眼里内存是一个有限的数组，我们在把寄存器里面的数据 push 进内存的时候栈指针（%rsp）要向着地址减小的方向移动，这就是 %rsp - 8 的原因。\n图片\n算术与逻辑指令 对于算术指令我们想起CPU中最重要的部件 ALU 算术逻辑单元，基本上所有的这些指令通过 opcode 来在多路选择上 指挥 ALU正确的使用算术。\n\u003e 注：下面的所有指令都可以根据数据类型加 suffix (b/w/l/q)\nUnary Operation(一元操作) 1 2 3 4 inc Deat Deat+1-\u003eDeat # 按1递增 dec Deat Deat-1-\u003eDeat # 按1递减 neg Deat -Deat-\u003eDeat (取反) # 算术取反 not Deat ~Deat-1-\u003eDeat （取补） # 按位取反 一元操作只有一个操作数，即做源也是目的。可以是Reg or Mem 。\nBinary Operation(二元操作) 1 2 3 4 5 6 7 leaq S，D \u0026S -\u003e D # 将源地址的有效地址加载到目标中 add S，D D + S -\u003e D # 将源加到目标中 sub S，D D - S -\u003e D # 将源从目标中减去 imul S，D D * S -\u003e D # 目标乘以源 xor S，D D ^ S -\u003e D # 按位异或目标和来源 or S，D D | S -\u003e D # 按位或目标和来源 and S, D D \u0026 S -\u003e D # 按位与目标和来源 对于第二个到最后一个不需要再说了，都是字面意思。主要来说一说 leaq 这个指令。\nLoad effective address(加载有效地址) , leaq 有两个作用：\n将其源操作数的有效地址（而不是该地址处的数据）加载到其目标寄存器中 在 C语言里面就是 \u0026S , 这样的好处是可以给下面的内存产生指针。 也可用于执行与寻址无关的算术运算。（eg： leaq (%rdi, %rsi, 4), %rax 相同与 x + 4*y ) Shift Operations(移位操作) 1 2 3 sal[b|w|l|q] imm,d d = d \u003c\u003c imm # 左移imm位 sar[b|w|l|q] imm,d d = d \u003e\u003e imm # 算术右移imm位 shr[b|w|l|q] imm,d d = d \u003e\u003e imm # 逻辑右移imm位 Special Arithmetic Operations(特殊算术操作) 1 2 3 4 5 6 imulq S # 有符号全乘法 四字到八字 mulq S # 无符号全乘法 四字到八字 idivq S # 有符号全除法 八字到四字 divq S # 无符号全除法 八字到四字 cltd # sign extend %eax into %edx::%eax cqto # sign extend %rax into %rdx::%rax 在特殊算术里面，这样的设计是为了补码的乘除有扩展。由两个64位的到全128位的乘积和整数除法的截断。\n除法需要特殊的安排：idiv（有符号） 和 div（无符号） 操作在2n字节被除数和n字节除数上，产生一个n字节商和n字节余数。被除数总是存在于一对固定寄存器中（32位情况下为%edx和%eax；64位情况下为%rdx和%rax）；除数作为指令中的源操作数来指定。商放在％eax（resp. ％rax）中; 余数放在％edx（resp. ％rdx）中。对于有符号的除法，使用cltd（resp.ctqo）指令来准备％edx(resp.%rdx)，并将其与％eax(resp.%rax)的符号扩展配合使用。例如，如果a、b、c是保存四个字长的内存位置，则可以使用以下序列设置c = a / b：\n1 2 3 4 movq a(%rip), %rax ctqo idivq b(%rip) movq %rax, c(%rip) 上文来自文档）\n控制指令 到目前为止，我们看到的都是顺序一条接着一条的操作的，但是在我们的c语言里面还有条件语句（if）、循环语句（while）、分支语句（switch）等，很明显都不是顺序的，要进行某种跳转，而这种跳转是由机器代码来实现的，根据测试数据值来判断机器此时是否改变控制流。\n条件码 好了，到我们心心念的条件码了，条件码在CPU中是有单独的条件码寄存器，但是它只有单个位，它们描述的是距离最近的算术和逻辑操作的某些属性，CPU根据条件码寄存器来断定是否执行分支跳转。以下是四种条件码：\nZF result was Zero CF result caused Carry out of most significant bit (unsigned) SF result was negative (Sign bit was set) OF result caused (signed) Overflow （negative overflow, positive overflow） leaq 指令不改变任何的条件码。而不是所有的指令都要改变，如xor对于CF、OF会设置为0。\n指令集中也有专门来设置条件码的指令，它们不会改变任何的其他寄存器，只会改变条件码：\n1 2 3 4 cmp[b|w|l|q] s2,s1 # 比较两个值，S1 - S2 用减法的方法来比较 test[b|w|l|q] s2,s1 # 测试两个值，S1 \u0026 S2 可以来检查是负or正，也可以比较具体位的值 其实cmp和test有时是十分好用的测试指令，比如在对（x == 0）的时候，可以用 cmpl %eax, %eax 或者 testl %eax, %eax 来与自己比较来设置ZF条件码，也用来判断 %eax 是正数或负数。\n访问条件码 条件码通常是不会直接读取的，在x86中采用三种使用方式：\n可以根据条件码的某种位逻辑组合，将一个字节设置为0 或1。 可以条件跳转到程序的某个其他的部分。 可以有条件地传送数据。 这里会发现用了位的逻辑计算来确认大于或小于等情况。（需要好好看看第二章）\n第一点的实现 SET指令 1 2 3 4 5 6 7 8 9 10 11 12 sete / setz D Set if equal/zero ZF setne / setnz D Set if not equal/nonzero ~ ZF sets D Set if negative SF setns D Set if nonnegative ~ SF setg / setnle D Set if greater (signed) ~ (SF ^ 0F)\u0026 ~ ZF setge / setnl D Set if greater or equal (signed) ~ (SF ^ 0F) setl / setnge D Set if less (signed) SF^0F setle / setng D Set if less or equal (SF ^ OF)|ZF seta / setnbe D Set if above (unsigned) ~ CF\u0026 ~ ZF setae / setnb D Set if above or equal (unsigned) ~ CF setb / setnae D Set if below (unsigned) CF setbe / setna D Set if below or equal (unsigned) CF|ZF SET指令，每条指令根据条件码的各种组合将一个字节设置为 0或1。\n第二点的实现 Jump指令 1 2 3 4 5 6 7 8 9 10 11 12 13 14 jmp Label Jump to label true jmp *Operand Jump to specified location true je / jz Label Jump if equal/zero ZF jne / jnz Label Jump if not equal/nonzero ~ ZF js Label Jump if negative SF jns Label Jump if nonnegative ~ SF jg / jnle Label Jump if greater (signed) ~ (SF ^ 0F)\u0026 ~ ZF jge / jnl Label Jump if greater or equal (signed) ~ (SF ^ 0F) jl / jnge Label Jump if less (signed) SF^0F jle / jng Label Jump if less or equal (SF ^ OF)|ZF ja / jnbe Label Jump if above (unsigned) ~ CF\u0026 ~ ZF jae / jnb Label Jump if above or equal (unsigned) ~ CF jb / jnae Label Jump if below (unsigned) CF jbe / jna Label Jump if below or equal (unsigned) CF|ZF 跳转(jump) 指令会导致执行切换到程序中一个全新的位置。在汇编代码中，这些跳转的目的地通常用一个标号(Label) 指明。在下一个标题再继续深入jump指令。\n第三点的实现 cmove指令 1 2 3 4 5 6 7 8 9 10 11 12 cmove / cmovz S, D Move if equal/zero ZF cmovne / cmovnz S, D Move if not equal/nonzero ~ ZF cmovs S, D Move if negative SF cmovns S, D Move if nonnegative ~ SF cmovg / cmovnle S, D Move if greater (signed) ~ (SF ^ 0F)\u0026 ~ ZF cmovge / cmovnl S, D Move if greater or equal (signed) ~ (SF ^ 0F) cmovl / cmovnge S, D Move if less (signed) SF^0F cmovle / cmovng S, D Move if less or equal (SF ^ OF)|ZF cmova / cmovnbe S, D Move if above (unsigned) ~ CF\u0026 ~ ZF cmovae / cmovnb S, D Move if above or equal (unsigned) ~ CF cmovb / cmovnae S, D Move if below (unsigned) CF cmovbe / cmovna S, D Move if below or equal (unsigned) CF|ZF 条件传送指令, 但传送条件满足的时候,指令把S复制到D中。\nC语言中的条件分支 现在来进行对C语言中一些常见的分支跳转操作来看看翻译后的机器代码。\nif-else C 语言中的江-else 语旬的通用形式模板如下：\n1 2 3 4 if (test-expr) then-statement else els-statement 汇编器工作是为 then-statement 和 else-statement 产生各自的代码块。它会插入条件和无条件分支，以保证能执行正确的代码块。\n看一个例子\n1 2 3 4 5 6 7 8 9 10 long absdiff(long x, long y) { long result; if (x \u003c y) result = y-x; else result = x-y; return result; } 1 2 3 4 5 6 7 8 9 10 long absdiff_es(long x, long y) { long result; if (x \u003e y) result = x-y; else result = y-x; return result; } 分别产生的汇编代码\n1 2 3 4 5 6 7 8 9 # x in %rdi, y in %rai absdiff : movq %rsi, %rax subq %rdi, %rax rval = y-x movq %rdi, %rdx subq %rsi, %rdx eval = x-y cmpq %rsi, %rdi 比较 x:y cmovge %rdx, %rax If \u003e=, rval = eval ret Return tval 1 2 3 4 5 6 7 8 9 10 11 absdiff_es: cmpq %rsi, %rdi jle .L4 movq %rdi, %rax subq %rsi, %rax ret .L4: # x \u003c= y movq %rsi, %rax subq %rdi, %rax ret [为什么基于条件数据传送(1)的代码会比基于条件控制转移(2)的代码性能要好？]\nwhile while 语句的通用形式如下：\n1 2 while (test-expr) body-statement 例子\n1 2 3 4 5 6 7 8 9 long fact_while(long n) { long result = 1; while (n \u003e 1) { result *= n; n = n-1; } return result; } do-while do-while 语句的通用形式如下：\n1 2 3 do body-statement while (test-expr); 例子\n1 2 3 4 5 6 7 8 9 10 11 12 // Do While 的 C 语言代码 long pcount_do(unsigned long x) { long result = 0; do { result += x \u0026 0x1; x \u003e\u003e= 1; } while (x); return result; } 产生的汇编代码\n1 2 3 4 5 6 7 8 9 movl $0, %eax # result = 0 .L2: # loop: movq %rdi, %rdx andl $1, %edx # t = x \u0026 0x1 addq %rdx, %rax # result += t shrq %rdi # x \u003e\u003e= 1 jne .L2 # if (x) goto loop rep # ret for for 循环的通用形式如下：\n1 2 for (init-expr; test-expr; update-expr) body-statement switch switch 循环的通用形式如下：\n1 2 3 4 5 6 7 8 switch(n){ case test-expr: body-statement break; case test-expr: body-statement break; } 对于C语言的这些语法我只是在这里举出例子来，最好看看书上的讲解。\n分支跳转(RISC-V) 对于这个分类其实我分给了RISC-V， 主要是在x86-64中的控制指令和RISC-V的分支跳转其实是一回事，主要区别是否使用的条件码（其实在我看来RISC-V也用了条件码，但是是隐式的使用）。\nRISC-V的 Branch Instruction\n1 2 （施工中🚧） 过程调用 过程是软件中一种很重要的抽象。它提供了一种封装代码的方式，用一组指定的参数和一个可选的返回值实现了某种功能。然后，可以在程序中不同的地方调用这个函数。设计良好的软件用过程作为抽象机制，隐藏某个行为的具体实现，同时又提供清晰简洁的接口定义，说明要计算的是哪些值，过程会对程序状态产生什么样的影响。不同编程语言中，过程的形式多样：函数(function) 、方法(method) 、子例(subroutine) 、处理函数(handler) 等等，但是它们有一些共有的特性。\n过程调用主要有三个机制：\n控制传递。包括如何开始执行过程代码，以及如何返回到开始的地方。本质上是代码执行地址的改变和切换。\n数据传递。调用函数时要传给函数一些参数，在返回函数时也可能会将一些函数计算结果以返回值形式返回给原函数。本质上是数据传入新过程，又传回原过程。\n内存管理。在过程进行时，如何分配内存空间；在过程返回后，如何销毁内存中存储的局部变量。\n数据存储分配 外部链接 摩尔定律—Wiki\n微处理器—Wiki\nThe 50 Year History of the Microprocessor\n芯片相关– Cpu历史–AMD系列\n芯片相关– Cpu历史–intel系列\n【读薄 CSAPP】贰 机器指令与程序优化\nRISC-V手册\nRISC-V基本指令集概述\n过程调用\n","wordCount":"6783","inLanguage":"zh-cn","datePublished":"2023-04-09T20:13:06+08:00","dateModified":"2023-04-09T20:13:06+08:00","author":[{"@type":"Person","name":"Yeelight"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://yeekox.netlify.app/zh-cn/posts/csapp02/"},"publisher":{"@type":"Organization","name":"Yeelight の 小屋","logo":{"@type":"ImageObject","url":"https://yeekox.netlify.app/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://yeekox.netlify.app/zh-cn/ accesskey=h title="Yeelight の 小屋 (Alt + H)">Yeelight の 小屋</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://yeekox.netlify.app/zh-cn/about title=About👋><span>About👋</span></a></li><li><a href=https://yeekox.netlify.app/zh-cn/tags title=Tags🔖><span>Tags🔖</span></a></li><li><a href=https://yeekox.netlify.app/zh-cn/categories title=Categories📂><span>Categories📂</span></a></li><li><a href=https://yeekox.netlify.app/zh-cn/archives title=Archives📦><span>Archives📦</span></a></li><li><a href=https://yeekox.netlify.app/zh-cn/search title="Search🔍 (Alt + /)" accesskey=/><span>Search🔍</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://yeekox.netlify.app/zh-cn/>Home</a>&nbsp;»&nbsp;<a href=https://yeekox.netlify.app/zh-cn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">二.程序的机器级表示(CSAPP)</h1><div class=post-meta><span title='2023-04-09 20:13:06 +0800 CST'>April 9, 2023</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;Yeelight</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#%e5%be%ae%e5%a4%84%e7%90%86%e5%99%a8%e5%8e%86%e5%8f%b2 aria-label=微处理器历史>微处理器历史</a><ul><li><a href=#intel%e7%9a%84x86 aria-label=Intel的x86>Intel的x86</a></li></ul></li><li><a href=#%e5%9f%ba%e6%9c%ac%e6%a6%82%e5%bf%b5 aria-label=基本概念>基本概念</a><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af%e7%bc%96%e8%af%91 aria-label=什么是编译>什么是编译</a></li></ul></li><li><a href=#%e5%a4%84%e7%90%86%e5%99%a8%e7%9a%84%e5%b7%a5%e4%bd%9c aria-label=处理器的工作>处理器的工作</a></li><li><a href=#%e4%bb%80%e4%b9%88%e6%98%afisa aria-label=什么是ISA>什么是ISA</a></li><li><a href=#ciscrisc%e5%8c%ba%e5%88%ab aria-label=CISC&amp;RISC区别>CISC&amp;RISC区别</a></li></ul><li><a href=#%e5%bc%80%e5%a7%8b%e5%bf%ab%e4%b9%90%e7%9a%84%e6%b1%87%e7%bc%96 aria-label=开始快乐的汇编>开始快乐的汇编</a><ul><li><a href=#%e6%95%b4%e5%9e%8b%e5%af%84%e5%ad%98%e5%99%a8 aria-label=整型寄存器>整型寄存器</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b aria-label=数据类型>数据类型</a></li><li><a href=#%e6%93%8d%e4%bd%9c%e6%95%b0%e6%8c%87%e7%a4%ba%e7%ac%a6 aria-label=操作数指示符>操作数指示符</a><ul><li><a href=#%e6%93%8d%e4%bd%9c%e6%95%b0%e5%9f%ba%e6%9c%ac aria-label=操作数基本>操作数基本</a></li><li><a href=#%e5%af%bb%e5%9d%80 aria-label=寻址>寻址</a></li></ul></li><li><a href=#%e6%8c%87%e4%bb%a4 aria-label=指令>指令</a><ul><li><a href=#%e6%95%b0%e6%8d%ae%e7%a7%bb%e5%8a%a8%e6%8c%87%e4%bb%a4 aria-label=数据移动指令>数据移动指令</a></li><li><a href=#%e7%a8%8b%e5%ba%8f%e6%a0%88%e6%8c%87%e4%bb%a4 aria-label=程序栈指令>程序栈指令</a></li><li><a href=#%e7%ae%97%e6%9c%af%e4%b8%8e%e9%80%bb%e8%be%91%e6%8c%87%e4%bb%a4 aria-label=算术与逻辑指令>算术与逻辑指令</a><ul><li><a href=#unary-operation%e4%b8%80%e5%85%83%e6%93%8d%e4%bd%9c aria-label="Unary Operation(一元操作)">Unary Operation(一元操作)</a></li><li><a href=#binary-operation%e4%ba%8c%e5%85%83%e6%93%8d%e4%bd%9c aria-label="Binary Operation(二元操作)">Binary Operation(二元操作)</a></li><li><a href=#shift-operations%e7%a7%bb%e4%bd%8d%e6%93%8d%e4%bd%9c aria-label="Shift Operations(移位操作)">Shift Operations(移位操作)</a></li><li><a href=#special-arithmetic-operations%e7%89%b9%e6%ae%8a%e7%ae%97%e6%9c%af%e6%93%8d%e4%bd%9c aria-label="Special Arithmetic Operations(特殊算术操作)">Special Arithmetic Operations(特殊算术操作)</a></li></ul></li><li><a href=#%e6%8e%a7%e5%88%b6%e6%8c%87%e4%bb%a4 aria-label=控制指令>控制指令</a><ul><li><a href=#%e6%9d%a1%e4%bb%b6%e7%a0%81 aria-label=条件码>条件码</a></li><li><a href=#%e8%ae%bf%e9%97%ae%e6%9d%a1%e4%bb%b6%e7%a0%81 aria-label=访问条件码>访问条件码</a></li><li><a href=#c%e8%af%ad%e8%a8%80%e4%b8%ad%e7%9a%84%e6%9d%a1%e4%bb%b6%e5%88%86%e6%94%af aria-label=C语言中的条件分支>C语言中的条件分支</a><ul><li><a href=#if-else aria-label=if-else>if-else</a></li><li><a href=#while aria-label=while>while</a></li><li><a href=#do-while aria-label=do-while>do-while</a></li><li><a href=#for aria-label=for>for</a></li></ul></li><li><a href=#switch aria-label=switch>switch</a></li></ul></li><li><a href=#%e5%88%86%e6%94%af%e8%b7%b3%e8%bd%acrisc-v aria-label=分支跳转(RISC-V)>分支跳转(RISC-V)</a></li></ul></li><li><a href=#%e8%bf%87%e7%a8%8b%e8%b0%83%e7%94%a8 aria-label=过程调用>过程调用</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e5%88%86%e9%85%8d aria-label=数据存储分配>数据存储分配</a></li><li><a href=#%e5%a4%96%e9%83%a8%e9%93%be%e6%8e%a5 aria-label=外部链接>外部链接</a></li></ul></li></ul></div></details></div><div class=post-content><p>#入门</p><h2 id=微处理器历史>微处理器历史<a hidden class=anchor aria-hidden=true href=#微处理器历史>#</a></h2><h3 id=intel的x86>Intel的x86<a hidden class=anchor aria-hidden=true href=#intel的x86>#</a></h3><p>在这里我想来简单的说道说道微处理器的历史发展，特此说明一下我不是专业的🙄，因此我没有详细的<code>深入研究</code>，如果有任何的错误请告诉我，谢谢。</p><p>自从1971年的Intel4004既第一款微处理器，也是全球第一款微处理器开始，我们人类社会标志着进入微芯片时代，在这个时代有三个主要的趋势：</p><ul><li>处理器的位长的倍增</li><li>指令集的快速发展</li><li>时钟频率的快速增加</li></ul><p>Intel也逐步发布了<code>Intel 8008</code>一个8位的，<code>Intel 8086</code> 一个16位的，至此，Intel的x86<code>帝国</code>开始了。在1985年，Intel的32位处理器<code>IA32</code>问世，而随着摩尔定律等的种种限制，单核的处理器已经遇到瓶颈了，各大公司继而转向了高频率、低功耗的多核处理器，处理器进入多核/多线程时代（2005）。</p><p>在一些无论是竞争关系，还是研究关系，导致目前的市场上出现了两种<strong>指令集计算机</strong></p><ul><li>CISC(<em>Complex instruction set computer</em>)</li><li>RISC(<em>Reduced instruction set computer</em>)</li></ul><p>在后面我会再提到的。</p><p>我不知道未来的处理器向哪个方向发展，也不知道Intel是否一直在前沿（AMD：呵呵），但我相信，人类的智慧使得世界自第二次工业革命以来史无前例的大发展，在未来一定有着不一样的发展。</p><h2 id=基本概念>基本概念<a hidden class=anchor aria-hidden=true href=#基本概念>#</a></h2><blockquote><p>嗯嗯，回来回来，不去想未来，做好当下。</p></blockquote><p>在了解具体的体系系统前，我们来了解基本的一些东西：</p><p><img loading=lazy src=https://s2.loli.net/2023/04/24/Jp2IxPhfSWjHNZz.png alt=CS61cCS></p><p>上面是来自CS61c的图片，我们现在要了解就是整个软件到硬件的过程，也可以说是抽象到具体的过程。</p><p><strong>Instructure Set Architecture</strong>：指令集架构 (包括指令规格，不同规则寄存器等)，简称ISA，它是软硬件之间的<code>桥梁</code>。</p><p><strong>Processor</strong>、<strong>Memory</strong>、<strong>I/O system</strong>：这是由OS进行控制的。</p><p>我们这章主要的是学习ISA，CSAPP主要是x86-64的CISC指令集，CS61c主要是RISC-V的RISC指令集，没错，它们是不同的指令集，在我的笔记里面我也会不时的写上RISC-V的一些表示来证明我学习过了（笑）。</p><h3 id=什么是编译>什么是编译<a hidden class=anchor aria-hidden=true href=#什么是编译>#</a></h3><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>
</span></span><span style=display:flex><span>高级语言 --&gt; 汇编语言 --&gt; 机器语言
</span></span></code></pre></td></tr></table></div></div><p>在我们的零章的时候我说过一个*.c文件如何变成的一个可执行的程序的一个主要过程，它有一个步骤是<strong>编译</strong>，这是一个我们需要细细品味的步骤。</p><p>编译过程是一个由某个高级语言（比如c文件）经过编译器的一系列的处理成为可读性低的汇编语言。换而言之，就是把我们十分清楚明白的抽象语言转换成机器语言（值得注意的是，此时机器也不知道汇编语言），在经历汇编译器<strong>翻译</strong>成二进制代码，真正的机器语言，机器可以读懂了，但我们看不懂（除了某些黑客）。</p><p><img loading=lazy src=https://s2.loli.net/2023/04/24/ARQExTsuyrhdgYO.png alt=CALL></p><p>上面是cs61c中的<em>从C到机器语言</em>的完整过程，十分的详细了。程序的运行就是想像是一个<strong>翻译</strong>过程，用上一些我们明文规定的语法规则，使用编译器（GCC等）来当我们程序员和机器之间的<strong>翻译官</strong>。</p><p>现在来看一看从 <code>C语言</code> 到<code>机器代码</code>(一个整型加法计算的汇编代码)</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>  <span style=color:#6c7086;font-style:italic>// filename: clcyle_one
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span> 
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>#include</span> <span style=color:#6c7086;font-weight:700;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#6c7086;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#f38ba8>int</span> <span style=color:#89b4fa>main</span>(<span style=color:#f38ba8>int</span> argc, <span style=color:#f38ba8>char</span> <span style=color:#cba6f7>const</span> <span style=color:#89dceb;font-weight:700>*</span>argv[])
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>int</span> sum <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#fab387>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>for</span> (<span style=color:#f38ba8>int</span> i <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#fab387>0</span>; i <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#fab387>10</span>; <span style=color:#89dceb;font-weight:700>++</span>i)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        sum <span style=color:#89dceb;font-weight:700>+=</span> i;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> <span style=color:#fab387>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>经过gcc的编译，在自己的Linux机器上使用以下的代码</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ gcc -Og -S clcyle_one.c
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>    <span style=color:#89b4fa>.file</span>   <span style=color:#a6e3a1>&#34;clcyle_one.c&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>.text</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>.globl</span>  <span style=color:#f9e2af>main</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>.type</span>   <span style=color:#f9e2af>main</span>, <span style=color:#89b4fa>@function</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>main:</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>.LFB7:</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>.cfi_startproc</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movl</span>    <span style=color:#f9e2af>$0</span>, <span style=color:#f5e0dc>%eax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>jmp</span> <span style=color:#f9e2af>.L2</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>.L3:</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>addl</span>    <span style=color:#f9e2af>$1</span>, <span style=color:#f5e0dc>%eax</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>.L2:</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>cmpl</span>    <span style=color:#f9e2af>$9</span>, <span style=color:#f5e0dc>%eax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>jle</span> <span style=color:#f9e2af>.L3</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movl</span>    <span style=color:#f9e2af>$0</span>, <span style=color:#f5e0dc>%eax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>ret</span>
</span></span><span style=display:flex><span>    <span style=color:#6c7086;font-style:italic>#（不用在意类似 .file 的指令，它们是伪指令， 要从main看起）
</span></span></span></code></pre></td></tr></table></div></div><p>两者相互比较一下我们可以发现，C 语言代码被处理成统一格式的汇编代码，在汇编代码中，第一个字符串叫做操作符，后面的是源和目的<code>寄存器</code>（这是一个大玩意😣）。操作和操作数明确，在下面我们会到不同的操作符分类分析（我想把RISC-V的加入作比较），记住一个条件，<code>读取</code>/<code>运算操作</code>是一个<strong>线性逐句逐次</strong>的操作，PC指令是有现态和次态之分。</p><h2 id=处理器的工作>处理器的工作<a hidden class=anchor aria-hidden=true href=#处理器的工作>#</a></h2><p>在我们对操作指令分类讨论之前我们来认识处理器是怎么工作的，</p><p><img loading=lazy src=https://s2.loli.net/2023/04/24/3isvAmjMY8E9IgP.jpg alt=x86-64></p><p><img loading=lazy src=https://s2.loli.net/2023/04/24/Fzb3uHQBLTlqOgD.png alt="cs61c cpu"></p><p>上面的图片(分别来自CSapp和CS61c)十分清楚的展示了处理器对于存放在主存里面的指令有着什么样的操作，主要的就两点<strong>存、读取值</strong>和<strong>计算</strong>。在x86-64里面还有一个叫作<strong>条件码</strong>的东东，我会在下面说到因为我也第一次看见这个。</p><p>这是一个<strong>CPU到Memory</strong>的一个过程，具体的是一个处理器从内存某个地址取值（有数据和指令）拿到<strong>CPU</strong>里的<strong>寄存器</strong>通过<strong>ALU</strong>计算，再根据<strong>PC</strong>选择下一步。</p><ul><li><p><strong>程序计数器</strong>(PC, Program counter) - 存着下一条指令的地址，在 x86-64 中称为 RIP。</p></li><li><p><strong>寄存器</strong>(Register) - 用来存储数据以便操作。</p></li><li><p><strong>条件代码</strong>(Codition codes) - 通常保存最近的算术或逻辑操作后的信息，用来做条件跳转的条件。</p></li></ul><h2 id=什么是isa>什么是ISA<a hidden class=anchor aria-hidden=true href=#什么是isa>#</a></h2><p><strong>Instruction Set Architecture</strong> (指令集框架) 是包含了针对某个特定处理器执行的基本操作码（<em>opcode</em>），里面是基本命令，在我们学习的<code>x86-64</code>、<code>RISC-V</code>都有不同的ISA。</p><p>为了学习方便，我们一般要把ISA根据使用的方法不同进行不同的分类。</p><ul><li>资料处理与访问操作</li><li>算术逻辑操作</li><li>控制过程操作</li></ul><p>在下面我会一一分析。</p><h2 id=ciscrisc区别>CISC&amp;RISC区别<a hidden class=anchor aria-hidden=true href=#ciscrisc区别>#</a></h2><p>CISC(<em>Complex instruction set computer</em>)</p><blockquote><p>兼容性性强，指令繁多，长度可变，由微程序实现。
代表：x86-64</p></blockquote><p>RISC(<em>Reduced instruction set computer</em>)</p><blockquote><p>指令少，使用频率接近，主要是依靠硬件实现（通用寄存器、硬布线逻辑控制）。
代表：RISC-V</p></blockquote><h1 id=开始快乐的汇编>开始快乐的汇编<a hidden class=anchor aria-hidden=true href=#开始快乐的汇编>#</a></h1><h2 id=整型寄存器>整型寄存器<a hidden class=anchor aria-hidden=true href=#整型寄存器>#</a></h2><p><img loading=lazy src=https://s2.loli.net/2023/04/24/pYIjkJMEBKc413b.png alt=Reg></p><p>在x86-64上有16个64位的<strong>通用寄存器</strong>；对于每个寄存器的低32、16和8位可以独立地通过其他不同指令名称访问，原则上，几乎任何寄存器都可以用于保存几乎任何逻辑和算术操作的操作数，但有些具有特殊或受限制的用途。</p><p>一个寄存器有着64位、32位、16位、8位这可以对以前的低位程序向下兼容。</p><p>按照惯例，%rsp被保留作为堆栈指针，并且因为一些指令（例如push、pop、call）隐含使用它。%rsp指向最低占用的堆栈位置（而不是下一个要使用的位置）。</p><p>寄存器%rbp有时被用作帧指针，即当前堆栈帧的基址。指令计数器寄存器（％rip） 指向要执行的下一条命令; 程序员无法直接访问它, 但是大量地被用作基于位置无关代码寻址的基础。还有一些其他指令隐含地使用某些寄存器；例如，整数乘法和除法指令需要%rax和%rdx。</p><h2 id=数据类型>数据类型<a hidden class=anchor aria-hidden=true href=#数据类型>#</a></h2><p>既然我们的寄存器有着不同位的表示，那就是说处理器在操作不同的数据时使用着不同位数的寄存器来提高速率。</p><p>我们针对不同的数据类型使用不同的<strong>suffix</strong>和<strong>size</strong>：</p><table><thead><tr><th style=text-align:center>Data type</th><th style=text-align:center>suffix</th><th style=text-align:center>size</th><th style=text-align:center>word</th></tr></thead><tbody><tr><td style=text-align:center>char</td><td style=text-align:center>b</td><td style=text-align:center>1B</td><td style=text-align:center>Byet</td></tr><tr><td style=text-align:center>short</td><td style=text-align:center>w</td><td style=text-align:center>2B</td><td style=text-align:center>1word</td></tr><tr><td style=text-align:center>int</td><td style=text-align:center>l</td><td style=text-align:center>4B</td><td style=text-align:center>2word</td></tr><tr><td style=text-align:center>long</td><td style=text-align:center>q</td><td style=text-align:center>8B</td><td style=text-align:center>4word</td></tr><tr><td style=text-align:center>char*</td><td style=text-align:center>q</td><td style=text-align:center>8B</td><td style=text-align:center>4word</td></tr><tr><td style=text-align:center>float</td><td style=text-align:center>s</td><td style=text-align:center>4B</td><td style=text-align:center>2word</td></tr><tr><td style=text-align:center>double</td><td style=text-align:center>l</td><td style=text-align:center>8B</td><td style=text-align:center>4word</td></tr></tbody></table><p>上面的<strong>suffix</strong>列显示了在 GNU 汇编程序用来指定适当大小的变体的字母指示。</p><p>而一个新单位<strong>word</strong>是相等于2个字节的大小。</p><h2 id=操作数指示符>操作数指示符<a hidden class=anchor aria-hidden=true href=#操作数指示符>#</a></h2><h3 id=操作数基本>操作数基本<a hidden class=anchor aria-hidden=true href=#操作数基本>#</a></h3><p>以下的都是在操作数里面主要数值表达的意思：</p><ul><li><strong>Imm</strong>   refers to a constant value, e.g. 0x8048d8e or 48</li><li><strong>r</strong>     refers to a register.  e.g. %rax or %edi</li><li><strong>R[r]</strong>  refers to the value stored in register address r.</li><li><strong>M[i]</strong>  refers to the value stored at memory address i .</li></ul><p>不同的格式表示不同的类型。</p><h3 id=寻址>寻址<a hidden class=anchor aria-hidden=true href=#寻址>#</a></h3><blockquote><p>很重要！！！</p></blockquote><p>对于寻址来说，比较通用的格式是：<code>Imm(Rb, Ri, S) -> M[R[Rb] + S*R[Ri]+ Imm]</code>，其中：</p><ul><li><strong>Imm</strong> - 常数偏移量</li><li><strong>Rb</strong> - 基寄存器</li><li><strong>Ri</strong> - 索引寄存器，不能是 %rsp</li><li><strong>S</strong> - 系数</li></ul><p><img loading=lazy src=https://s2.loli.net/2023/04/24/LPK7kRoNwmFVfi2.png alt=OperandSpecifiers></p><h2 id=指令>指令<a hidden class=anchor aria-hidden=true href=#指令>#</a></h2><p>接下来我们就来看看不同分类的指令格式，我按书上的顺序来说的，它也是按我们在平时使用的频率顺序来教的。</p><p>大多数的指令都是使用上文提过的 <strong>suffix</strong> 来显示操作数的大小的。</p><h3 id=数据移动指令>数据移动指令<a hidden class=anchor aria-hidden=true href=#数据移动指令>#</a></h3><p>对于 <strong>mov</strong> 指令来说，需要<strong>源操作数</strong>和<strong>目标操作数</strong>。指令的具体格式可以这样写 <code>mov? Src, Dest</code>，第一个是源操作数，第二个是目标操作数</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>mov</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>] <span style=color:#f9e2af>Src</span>, <span style=color:#f9e2af>Dest</span>                             <span style=color:#6c7086;font-style:italic># 将src移动到dest
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>movs</span>[<span style=color:#f9e2af>bw</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>bl</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>bq</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>wl</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>wq</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>lq</span>] <span style=color:#f9e2af>Src</span>, <span style=color:#f9e2af>Dest</span>                  <span style=color:#6c7086;font-style:italic># 带符号扩展的移动
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>movz</span>[<span style=color:#f9e2af>bw</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>bl</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>bq</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>wl</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>wq</span>] <span style=color:#f9e2af>Src</span>, <span style=color:#f9e2af>Dest</span>                     <span style=color:#6c7086;font-style:italic># 带零扩展的移动
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>movabsq</span> <span style=color:#f9e2af>imm</span>, <span style=color:#f9e2af>r</span>                                     <span style=color:#6c7086;font-style:italic># 移动绝对四字（imm为64位）
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cltq</span> <span style=color:#f9e2af>Src</span>, <span style=color:#f9e2af>Dest</span>                                     <span style=color:#6c7086;font-style:italic># 把%eax 符号扩展到%rax
</span></span></span></code></pre></td></tr></table></div></div><p>在使用 <strong>mov</strong> 指令的时候需要值得注意的是我们的源值和目的值的选址是有标准的, 源操作数可以是立即数、寄存器值或内存值的任意一种，但目标操作数只能是寄存器值或内存值</p><table><thead><tr><th style=text-align:center>Src</th><th style=text-align:center>Dest</th></tr></thead><tbody><tr><td style=text-align:center>imm</td><td style=text-align:center>Rag</td></tr><tr><td style=text-align:center>imm</td><td style=text-align:center>Mem</td></tr><tr><td style=text-align:center>Reg</td><td style=text-align:center>Reg</td></tr><tr><td style=text-align:center>Reg</td><td style=text-align:center>Mem</td></tr><tr><td style=text-align:center>Mem</td><td style=text-align:center>Reg</td></tr></tbody></table><blockquote><p>只有这五种的选择 ， 如果要把Mem -> Mem 的值移动，需要两步 Mem -> Reg -> Mem</p></blockquote><h3 id=程序栈指令>程序栈指令<a hidden class=anchor aria-hidden=true href=#程序栈指令>#</a></h3><p>这一部分就只有两个主要的指令，但是无比的重要。可以把数据压入程序栈中，以及在栈中弹出，程序栈在过程调用中起至关重要的作用。</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>pushq</span>  <span style=color:#f9e2af>Src</span>                    <span style=color:#6c7086;font-style:italic># 将4word的数据压入栈，并把%rsp - 8 -&gt; %rsp
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>popq</span>  <span style=color:#f9e2af>Dest</span>                    <span style=color:#6c7086;font-style:italic># 将4word的数据弹入栈，并把%rsp + 8 -&gt; %rsp
</span></span></span></code></pre></td></tr></table></div></div><p>对于程序栈指令十分重要的一点是我们对内存的变化要注意。在程序员的眼里内存是一个有限的数组，我们在把寄存器里面的数据 <code>push</code> 进内存的时候栈指针（%rsp）要向着地址减小的方向移动，这就是 <code>%rsp - 8</code> 的原因。</p><p>图片</p><h3 id=算术与逻辑指令>算术与逻辑指令<a hidden class=anchor aria-hidden=true href=#算术与逻辑指令>#</a></h3><p>对于算术指令我们想起CPU中最重要的部件 <code>ALU</code> 算术逻辑单元，基本上所有的这些指令通过
 <code>opcode</code> 来在多路选择上 <code>指挥</code> ALU正确的使用算术。</p><p> > 注：下面的所有指令都可以根据数据类型加 suffix (b/w/l/q)</p><h4 id=unary-operation一元操作>Unary Operation(一元操作)<a hidden class=anchor aria-hidden=true href=#unary-operation一元操作>#</a></h4><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>inc</span> <span style=color:#f9e2af>Deat</span>         <span style=color:#f9e2af>Deat</span><span style=color:#f38ba8>+</span><span style=color:#fab387>1</span>-<span style=color:#f38ba8>&gt;</span><span style=color:#f9e2af>Deat</span>           <span style=color:#6c7086;font-style:italic># 按1递增
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>dec</span> <span style=color:#f9e2af>Deat</span>         <span style=color:#f9e2af>Deat-1-</span><span style=color:#f38ba8>&gt;</span><span style=color:#f9e2af>Deat</span>           <span style=color:#6c7086;font-style:italic># 按1递减
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>neg</span> <span style=color:#f9e2af>Deat</span>         -<span style=color:#f9e2af>Deat-</span><span style=color:#f38ba8>&gt;</span><span style=color:#f9e2af>Deat</span>    (<span style=color:#f38ba8>取反</span>)  <span style=color:#6c7086;font-style:italic># 算术取反
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>not</span> <span style=color:#f9e2af>Deat</span>         <span style=color:#f38ba8>~</span><span style=color:#f9e2af>Deat-1-</span><span style=color:#f38ba8>&gt;</span><span style=color:#f9e2af>Deat</span> <span style=color:#f38ba8>（取补）</span> <span style=color:#6c7086;font-style:italic># 按位取反
</span></span></span></code></pre></td></tr></table></div></div><p>一元操作只有一个操作数，即做源也是目的。可以是<code>Reg or Mem</code> 。</p><h4 id=binary-operation二元操作>Binary Operation(二元操作)<a hidden class=anchor aria-hidden=true href=#binary-operation二元操作>#</a></h4><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>leaq</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>      <span style=color:#f38ba8>&amp;</span><span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>        <span style=color:#6c7086;font-style:italic># 将源地址的有效地址加载到目标中
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>add</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>      <span style=color:#f9e2af>D</span> <span style=color:#f38ba8>+</span> <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 将源加到目标中
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>sub</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>      <span style=color:#f9e2af>D</span> - <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 将源从目标中减去
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>imul</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>     <span style=color:#f9e2af>D</span> * <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 目标乘以源
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>xor</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>      <span style=color:#f9e2af>D</span> <span style=color:#f38ba8>^</span> <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 按位异或目标和来源
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>or</span> <span style=color:#f9e2af>S</span><span style=color:#f38ba8>，</span><span style=color:#f9e2af>D</span>       <span style=color:#f9e2af>D</span> <span style=color:#f38ba8>|</span> <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 按位或目标和来源
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>and</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>      <span style=color:#f9e2af>D</span> <span style=color:#f38ba8>&amp;</span> <span style=color:#f9e2af>S</span> -<span style=color:#f38ba8>&gt;</span> <span style=color:#f9e2af>D</span>      <span style=color:#6c7086;font-style:italic># 按位与目标和来源
</span></span></span></code></pre></td></tr></table></div></div><p>对于第二个到最后一个不需要再说了，都是字面意思。主要来说一说 <code>leaq</code> 这个指令。</p><p>Load effective address(加载有效地址) , leaq 有两个作用：</p><blockquote><ul><li>将其源操作数的有效地址（而不是该地址处的数据）加载到其目标寄存器中
  在 C语言里面就是 <code>&amp;S</code> , 这样的好处是可以给下面的内存产生指针。</li><li>也可用于执行与寻址无关的算术运算。（eg： <code>leaq (%rdi, %rsi, 4), %rax</code> 相同与 <code>x + 4*y </code>)</li></ul></blockquote><h4 id=shift-operations移位操作>Shift Operations(移位操作)<a hidden class=anchor aria-hidden=true href=#shift-operations移位操作>#</a></h4><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>sal</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>] <span style=color:#f9e2af>imm</span>,<span style=color:#f9e2af>d</span>   <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>&lt;&lt;</span> <span style=color:#f9e2af>imm</span>   <span style=color:#6c7086;font-style:italic># 左移imm位
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>sar</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>] <span style=color:#f9e2af>imm</span>,<span style=color:#f9e2af>d</span>   <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>&gt;&gt;</span> <span style=color:#f9e2af>imm</span>   <span style=color:#6c7086;font-style:italic># 算术右移imm位
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>shr</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>] <span style=color:#f9e2af>imm</span>,<span style=color:#f9e2af>d</span>   <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>d</span> <span style=color:#f38ba8>&gt;&gt;</span> <span style=color:#f9e2af>imm</span>   <span style=color:#6c7086;font-style:italic># 逻辑右移imm位
</span></span></span></code></pre></td></tr></table></div></div><h4 id=special-arithmetic-operations特殊算术操作>Special Arithmetic Operations(特殊算术操作)<a hidden class=anchor aria-hidden=true href=#special-arithmetic-operations特殊算术操作>#</a></h4><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>imulq</span> <span style=color:#f9e2af>S</span>                  <span style=color:#6c7086;font-style:italic># 有符号全乘法   四字到八字
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>mulq</span> <span style=color:#f9e2af>S</span>                   <span style=color:#6c7086;font-style:italic># 无符号全乘法   四字到八字
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>idivq</span> <span style=color:#f9e2af>S</span>                  <span style=color:#6c7086;font-style:italic># 有符号全除法   八字到四字
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>divq</span> <span style=color:#f9e2af>S</span>                   <span style=color:#6c7086;font-style:italic># 无符号全除法   八字到四字
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>cltd</span>                     <span style=color:#6c7086;font-style:italic># sign extend %eax into %edx::%eax
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>cqto</span>                     <span style=color:#6c7086;font-style:italic># sign extend %rax into %rdx::%rax
</span></span></span></code></pre></td></tr></table></div></div><p>在特殊算术里面，这样的设计是为了补码的乘除有扩展。由两个64位的到全128位的乘积和整数除法的截断。</p><p>除法需要特殊的安排：<code>idiv（有符号）</code> 和 <code>div（无符号）</code> 操作在2n字节被除数和n字节除数上，产生一个n字节商和n字节余数。被除数总是存在于一对固定寄存器中（32位情况下为%edx和%eax；64位情况下为%rdx和%rax）；除数作为指令中的源操作数来指定。商放在％eax（resp. ％rax）中; 余数放在％edx（resp. ％rdx）中。对于有符号的除法，使用cltd（resp.ctqo）指令来准备％edx(resp.%rdx)，并将其与％eax(resp.%rax)的符号扩展配合使用。例如，如果a、b、c是保存四个字长的内存位置，则可以使用以下序列设置c = a / b：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>    <span style=color:#89b4fa>movq</span> <span style=color:#f9e2af>a</span>(<span style=color:#f5e0dc>%rip</span>), <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>ctqo</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>idivq</span> <span style=color:#f9e2af>b</span>(<span style=color:#f5e0dc>%rip</span>)
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movq</span> <span style=color:#f5e0dc>%rax</span>, <span style=color:#f9e2af>c</span>(<span style=color:#f5e0dc>%rip</span>)
</span></span></code></pre></td></tr></table></div></div><p>上文来自文档）</p><h3 id=控制指令>控制指令<a hidden class=anchor aria-hidden=true href=#控制指令>#</a></h3><p>到目前为止，我们看到的都是顺序一条接着一条的操作的，但是在我们的c语言里面还有条件语句（if）、循环语句（while）、分支语句（switch）等，很明显都不是顺序的，要进行某种<strong>跳转</strong>，而这种跳转是由机器代码来实现的，根据测试数据值来判断机器此时是否改变控制流。</p><h4 id=条件码>条件码<a hidden class=anchor aria-hidden=true href=#条件码>#</a></h4><p>好了，到我们心心念的<strong>条件码</strong>了，条件码在CPU中是有单独的<strong>条件码寄存器</strong>，但是它只有单个位，它们描述的是距离最近的算术和逻辑操作的某些属性，CPU根据条件码寄存器来断定是否执行分支跳转。以下是四种条件码：</p><ul><li><strong>ZF</strong> result was Zero</li><li><strong>CF</strong> result caused Carry out of most significant bit (unsigned)</li><li><strong>SF</strong> result was negative (Sign bit was set)</li><li><strong>OF</strong> result caused (<strong>signed</strong>) Overflow （negative overflow, positive overflow）</li></ul><blockquote><p>leaq 指令不改变任何的条件码。而不是所有的指令都要改变，如<strong>xor</strong>对于CF、OF会设置为0。</p></blockquote><p>指令集中也有专门来设置条件码的指令，它们不会改变任何的其他寄存器，只会改变条件码：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmp</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>]  <span style=color:#f9e2af>s2</span>,<span style=color:#f9e2af>s1</span>                         <span style=color:#6c7086;font-style:italic># 比较两个值，S1 - S2 用减法的方法来比较
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>test</span>[<span style=color:#f9e2af>b</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>w</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>l</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>q</span>] <span style=color:#f9e2af>s2</span>,<span style=color:#f9e2af>s1</span>                         <span style=color:#6c7086;font-style:italic># 测试两个值，S1 &amp; S2 可以来检查是负or正，也可以比较具体位的值
</span></span></span></code></pre></td></tr></table></div></div><p>其实cmp和test有时是十分好用的测试指令，比如在对（x == 0）的时候，可以用 <code>cmpl %eax, %eax</code> 或者 <code>testl %eax, %eax</code> 来与自己比较来设置<strong>ZF</strong>条件码，也用来判断 <code>%eax</code> 是正数或负数。</p><h4 id=访问条件码>访问条件码<a hidden class=anchor aria-hidden=true href=#访问条件码>#</a></h4><p>条件码通常是不会直接读取的，在x86中采用三种使用方式：</p><ul><li>可以根据条件码的某种位逻辑组合，将一个字节设置为0 或1。</li><li>可以条件跳转到程序的某个其他的部分。</li><li>可以有条件地传送数据。</li></ul><blockquote><p>这里会发现用了位的逻辑计算来确认大于或小于等情况。（需要好好看看第二章）</p></blockquote><ol><li>第一点的实现 <strong>SET指令</strong></li></ol><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>sete</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setz</span>   <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>zero</span>                               <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setne</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnz</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>not</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>nonzero</span>                      <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>sets</span>          <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>negative</span>                                 <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setns</span>         <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>nonnegative</span>                            <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setg</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnle</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span> (<span style=color:#f9e2af>signed</span>)                 <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)<span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setge</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnl</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>signed</span>)           <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)
</span></span><span style=display:flex><span><span style=color:#89b4fa>setl</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnge</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> (<span style=color:#f9e2af>signed</span>)                           <span style=color:#f9e2af>SF</span><span style=color:#f38ba8>^</span><span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setle</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setng</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>                       (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#f9e2af>OF</span>)<span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>seta</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnbe</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> (<span style=color:#f9e2af>unsigned</span>)                     <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setae</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnb</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>unsigned</span>)              <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setb</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setnae</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span> (<span style=color:#f9e2af>unsigned</span>)                         <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>setbe</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>setna</span> <span style=color:#f9e2af>D</span>        <span style=color:#f9e2af>Set</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>unsigned</span>)               <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span></code></pre></td></tr></table></div></div><p>SET指令，每条指令根据条件码的各种组合将一个字节设置为 <strong>0或1</strong>。</p><ol start=2><li>第二点的实现 <strong>Jump指令</strong></li></ol><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>jmp</span> <span style=color:#f9e2af>Label</span>             <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>to</span> <span style=color:#f9e2af>label</span>                                   <span style=color:#f9e2af>true</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jmp</span> *<span style=color:#f9e2af>Operand</span>          <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>to</span> <span style=color:#f9e2af>specified</span> <span style=color:#f9e2af>location</span>                      <span style=color:#f9e2af>true</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>je</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jz</span> <span style=color:#f9e2af>Label</span>         <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>zero</span>                               <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jne</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnz</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>not</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>nonzero</span>                       <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>js</span> <span style=color:#f9e2af>Label</span>              <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>negative</span>                                 <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jns</span> <span style=color:#f9e2af>Label</span>             <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>nonnegative</span>                             <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jg</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnle</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span> (<span style=color:#f9e2af>signed</span>)                <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)<span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jge</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnl</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>signed</span>)           <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)
</span></span><span style=display:flex><span><span style=color:#89b4fa>jl</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnge</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> (<span style=color:#f9e2af>signed</span>)                           <span style=color:#f9e2af>SF</span><span style=color:#f38ba8>^</span><span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jle</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jng</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>                       (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#f9e2af>OF</span>)<span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>ja</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnbe</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> (<span style=color:#f9e2af>unsigned</span>)                    <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jae</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnb</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>unsigned</span>)               <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jb</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jnae</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span> (<span style=color:#f9e2af>unsigned</span>)                         <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>jbe</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>jna</span> <span style=color:#f9e2af>Label</span>       <span style=color:#f9e2af>Jump</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span> (<span style=color:#f9e2af>unsigned</span>)              <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span></code></pre></td></tr></table></div></div><p>跳转(jump) 指令会导致执行切换到程序中一个全新的位置。在汇编代码中，这些跳转的目的地通常用一个标号(<strong>Label</strong>) 指明。在下一个标题再继续深入jump指令。</p><ol start=3><li>第三点的实现 <strong>cmove指令</strong></li></ol><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#89b4fa>cmove</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovz</span>   <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>zero</span>                               <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovne</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnz</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>not</span> <span style=color:#f9e2af>equal</span><span style=color:#f38ba8>/</span><span style=color:#f9e2af>nonzero</span>                       <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovs</span>           <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>negative</span>                                 <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovns</span>          <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>nonnegative</span>                             <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>SF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovg</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnle</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span>                (<span style=color:#f9e2af>signed</span>)    <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)<span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovge</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnl</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>greater</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>       (<span style=color:#f9e2af>signed</span>)      <span style=color:#f38ba8>~</span> (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>)
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovl</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnge</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> (<span style=color:#f9e2af>signed</span>)                           <span style=color:#f9e2af>SF</span><span style=color:#f38ba8>^</span><span style=color:#fab387>0</span><span style=color:#f9e2af>F</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovle</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovng</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>less</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>                       (<span style=color:#f9e2af>SF</span> <span style=color:#f38ba8>^</span> <span style=color:#f9e2af>OF</span>)<span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmova</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnbe</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> (<span style=color:#f9e2af>unsigned</span>)                     <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>&amp;</span> <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>ZF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovae</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnb</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>above</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>        (<span style=color:#f9e2af>unsigned</span>)        <span style=color:#f38ba8>~</span> <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovb</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovnae</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span>                 (<span style=color:#f9e2af>unsigned</span>)         <span style=color:#f9e2af>CF</span>
</span></span><span style=display:flex><span><span style=color:#89b4fa>cmovbe</span> <span style=color:#f38ba8>/</span> <span style=color:#f9e2af>cmovna</span> <span style=color:#f9e2af>S</span>, <span style=color:#f9e2af>D</span>   <span style=color:#f9e2af>Move</span> <span style=color:#f9e2af>if</span> <span style=color:#f9e2af>below</span> <span style=color:#f9e2af>or</span> <span style=color:#f9e2af>equal</span>        (<span style=color:#f9e2af>unsigned</span>)        <span style=color:#f9e2af>CF</span><span style=color:#f38ba8>|</span><span style=color:#f9e2af>ZF</span>
</span></span></code></pre></td></tr></table></div></div><p>条件传送指令, 但传送条件满足的时候,指令把<code>S</code>复制到<code>D</code>中。</p><h4 id=c语言中的条件分支>C语言中的条件分支<a hidden class=anchor aria-hidden=true href=#c语言中的条件分支>#</a></h4><p>现在来进行对C语言中一些常见的分支跳转操作来看看翻译后的机器代码。</p><h5 id=if-else>if-else<a hidden class=anchor aria-hidden=true href=#if-else>#</a></h5><p>C 语言中的江-else 语旬的通用形式模板如下：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cba6f7>if</span> (test<span style=color:#89dceb;font-weight:700>-</span>expr)
</span></span><span style=display:flex><span>    then<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span><span style=display:flex><span><span style=color:#cba6f7>else</span>
</span></span><span style=display:flex><span>    els<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span></code></pre></td></tr></table></div></div><p>汇编器工作是为 <code>then-statement</code> 和 <code>else-statement</code> 产生各自的代码块。它会插入条件和无条件分支，以保证能执行正确的代码块。</p><p>看一个例子</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>long</span> <span style=color:#89b4fa>absdiff</span>(<span style=color:#f38ba8>long</span> x, <span style=color:#f38ba8>long</span> y)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>long</span> result;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> (x <span style=color:#89dceb;font-weight:700>&lt;</span> y)
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>=</span> y<span style=color:#89dceb;font-weight:700>-</span>x;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>else</span>
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>=</span> x<span style=color:#89dceb;font-weight:700>-</span>y;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> result;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>long</span> <span style=color:#89b4fa>absdiff_es</span>(<span style=color:#f38ba8>long</span> x, <span style=color:#f38ba8>long</span> y)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>long</span> result;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> (x <span style=color:#89dceb;font-weight:700>&gt;</span> y)
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>=</span> x<span style=color:#89dceb;font-weight:700>-</span>y;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>else</span>
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>=</span> y<span style=color:#89dceb;font-weight:700>-</span>x;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> result;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>分别产生的汇编代码</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span><span style=color:#6c7086;font-style:italic># x in %rdi, y in %rai
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89b4fa>absdiff</span> :
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movq</span> <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>subq</span> <span style=color:#f5e0dc>%rdi</span>, <span style=color:#f5e0dc>%rax</span>          <span style=color:#f9e2af>rval</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>y-x</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movq</span> <span style=color:#f5e0dc>%rdi</span>, <span style=color:#f5e0dc>%rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>subq</span> <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rdx</span>          <span style=color:#f9e2af>eval</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>x-y</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>cmpq</span> <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rdi</span>          <span style=color:#f38ba8>比较</span> <span style=color:#f9e2af>x</span>:<span style=color:#f9e2af>y</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>cmovge</span> <span style=color:#f5e0dc>%rdx</span>, <span style=color:#f5e0dc>%rax</span>       <span style=color:#f9e2af>If</span> <span style=color:#f38ba8>&gt;=</span>, <span style=color:#f9e2af>rval</span> <span style=color:#f38ba8>=</span> <span style=color:#f9e2af>eval</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>ret</span>                      <span style=color:#f9e2af>Return</span> <span style=color:#f9e2af>tval</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#89dceb>absdiff_es:</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>cmpq</span>    <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rdi</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>jle</span>     <span style=color:#f9e2af>.L4</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movq</span>    <span style=color:#f5e0dc>%rdi</span>, <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>subq</span>    <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>ret</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>.L4:</span>    <span style=color:#6c7086;font-style:italic># x &lt;= y
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>movq</span>    <span style=color:#f5e0dc>%rsi</span>, <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>subq</span>    <span style=color:#f5e0dc>%rdi</span>, <span style=color:#f5e0dc>%rax</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>ret</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>[为什么基于条件数据传送(1)的代码会比基于条件控制转移(2)的代码性能要好？]</p></blockquote><h5 id=while>while<a hidden class=anchor aria-hidden=true href=#while>#</a></h5><p>while 语句的通用形式如下：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cba6f7>while</span> (test<span style=color:#89dceb;font-weight:700>-</span>expr)
</span></span><span style=display:flex><span>    body<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span></code></pre></td></tr></table></div></div><p>例子</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#f38ba8>long</span> <span style=color:#89b4fa>fact_while</span>(<span style=color:#f38ba8>long</span> n)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>long</span> result <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#fab387>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>while</span> (n <span style=color:#89dceb;font-weight:700>&gt;</span> <span style=color:#fab387>1</span>) {
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>*=</span> n;
</span></span><span style=display:flex><span>        n <span style=color:#89dceb;font-weight:700>=</span> n<span style=color:#89dceb;font-weight:700>-</span><span style=color:#fab387>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> result;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h5 id=do-while>do-while<a hidden class=anchor aria-hidden=true href=#do-while>#</a></h5><p>do-while 语句的通用形式如下：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>    body<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>while</span> (test<span style=color:#89dceb;font-weight:700>-</span>expr);
</span></span></code></pre></td></tr></table></div></div><p>例子</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>// Do While 的 C 语言代码
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#f38ba8>long</span> <span style=color:#89b4fa>pcount_do</span>(<span style=color:#f38ba8>unsigned</span> <span style=color:#f38ba8>long</span> x)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f38ba8>long</span> result <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#fab387>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>do</span> {
</span></span><span style=display:flex><span>        result <span style=color:#89dceb;font-weight:700>+=</span> x <span style=color:#89dceb;font-weight:700>&amp;</span> <span style=color:#fab387>0x1</span>;
</span></span><span style=display:flex><span>        x <span style=color:#89dceb;font-weight:700>&gt;&gt;=</span> <span style=color:#fab387>1</span>;
</span></span><span style=display:flex><span>    } <span style=color:#cba6f7>while</span> (x);
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>return</span> result;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>产生的汇编代码</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>movl</span>    <span style=color:#f9e2af>$0</span>, <span style=color:#f5e0dc>%eax</span>    <span style=color:#6c7086;font-style:italic># result = 0
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span><span style=color:#89dceb>.L2:</span>                    <span style=color:#6c7086;font-style:italic># loop:
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>movq</span>    <span style=color:#f5e0dc>%rdi</span>, <span style=color:#f5e0dc>%rdx</span>
</span></span><span style=display:flex><span>    <span style=color:#89b4fa>andl</span>    <span style=color:#f9e2af>$1</span>, <span style=color:#f5e0dc>%edx</span>    <span style=color:#6c7086;font-style:italic># t = x &amp; 0x1
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>addq</span>    <span style=color:#f5e0dc>%rdx</span>, <span style=color:#f5e0dc>%rax</span>  <span style=color:#6c7086;font-style:italic># result += t
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>shrq</span>    <span style=color:#f5e0dc>%rdi</span>        <span style=color:#6c7086;font-style:italic># x &gt;&gt;= 1
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>jne</span>     <span style=color:#f9e2af>.L2</span>         <span style=color:#6c7086;font-style:italic># if (x) goto loop
</span></span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic></span>    <span style=color:#89b4fa>rep</span>                 <span style=color:#6c7086;font-style:italic># ret
</span></span></span></code></pre></td></tr></table></div></div><h5 id=for>for<a hidden class=anchor aria-hidden=true href=#for>#</a></h5><p>for 循环的通用形式如下：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cba6f7>for</span> (init<span style=color:#89dceb;font-weight:700>-</span>expr; test<span style=color:#89dceb;font-weight:700>-</span>expr; update<span style=color:#89dceb;font-weight:700>-</span>expr)
</span></span><span style=display:flex><span>    body<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span></code></pre></td></tr></table></div></div><h4 id=switch>switch<a hidden class=anchor aria-hidden=true href=#switch>#</a></h4><p>switch 循环的通用形式如下：</p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#cba6f7>switch</span>(n){
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>case</span> test<span style=color:#89dceb;font-weight:700>-</span><span style=color:#89dceb>expr</span>:
</span></span><span style=display:flex><span>        body<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>break</span>;
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>case</span> test<span style=color:#89dceb;font-weight:700>-</span><span style=color:#89dceb>expr</span>:
</span></span><span style=display:flex><span>        body<span style=color:#89dceb;font-weight:700>-</span>statement
</span></span><span style=display:flex><span>        <span style=color:#cba6f7>break</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>对于C语言的这些语法我只是在这里举出例子来，最好看看书上的讲解。</p><h3 id=分支跳转risc-v>分支跳转(RISC-V)<a hidden class=anchor aria-hidden=true href=#分支跳转risc-v>#</a></h3><p>对于这个分类其实我分给了RISC-V， 主要是在x86-64中的控制指令和RISC-V的分支跳转其实是一回事，主要区别是否使用的条件码（其实在我看来RISC-V也用了条件码，但是是隐式的使用）。</p><p>RISC-V的 <strong>Branch Instruction</strong></p><div class=highlight><div style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f849c">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f38ba8>（施工中🚧）</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=过程调用>过程调用<a hidden class=anchor aria-hidden=true href=#过程调用>#</a></h2><p>过程是软件中一种很重要的抽象。它提供了一种封装代码的方式，用一组指定的参数和一个可选的返回值实现了某种功能。然后，可以在程序中不同的地方调用这个函数。设计良好的软件用过程作为抽象机制，隐藏某个行为的具体实现，同时又提供清晰简洁的接口定义，说明要计算的是哪些值，过程会对程序状态产生什么样的影响。不同编程语言中，过程的形式多样：函数(function) 、方法(method) 、子例(subroutine) 、处理函数(handler) 等等，但是它们有一些共有的特性。</p><p>过程调用主要有三个机制：</p><ol><li><p><strong>控制传递</strong>。包括如何开始执行过程代码，以及如何返回到开始的地方。本质上是代码执行地址的改变和切换。</p></li><li><p><strong>数据传递</strong>。调用函数时要传给函数一些参数，在返回函数时也可能会将一些函数计算结果以返回值形式返回给原函数。本质上是数据传入新过程，又传回原过程。</p></li><li><p><strong>内存管理</strong>。在过程进行时，如何分配内存空间；在过程返回后，如何销毁内存中存储的局部变量。</p></li></ol><p><img loading=lazy src=https://s2.loli.net/2023/05/07/iWSVILyRpxh63Dl.jpg alt=callsk></p><h2 id=数据存储分配>数据存储分配<a hidden class=anchor aria-hidden=true href=#数据存储分配>#</a></h2><h2 id=外部链接>外部链接<a hidden class=anchor aria-hidden=true href=#外部链接>#</a></h2><p><a href=https://zh.wikipedia.org/wiki/%E6%91%A9%E5%B0%94%E5%AE%9A%E5%BE%8B>摩尔定律&mdash;Wiki</a></p><p><a href=https://zh.wikipedia.org/wiki/%E5%BE%AE%E5%A4%84%E7%90%86%E5%99%A8>微处理器&mdash;Wiki</a></p><p><a href=https://zhuanlan.zhihu.com/p/511271401><em>The 50 Year History of the Microprocessor</em></a></p><p><a href=https://zhuanlan.zhihu.com/p/464721330>芯片相关&ndash; Cpu历史&ndash;AMD系列</a></p><p><a href=https://zhuanlan.zhihu.com/p/464413953>芯片相关&ndash; Cpu历史&ndash;intel系列</a></p><p><a href=https://wdxtub.com/csapp/thin-csapp-2/2016/04/16/>【读薄 CSAPP】贰 机器指令与程序优化</a></p><p><a href=http://riscvbook.com/chinese/RISC-V-Reader-Chinese-v2p1.pdf>RISC-V手册</a></p><p><a href=https://www.sunnychen.top/archives/riscvbasic>RISC-V基本指令集概述</a></p><p><a href=https://segmentfault.com/a/1190000022161796>过程调用</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://yeekox.netlify.app/zh-cn/tags/csapp/>CSAPP</a></li></ul><nav class=paginav><a class=prev href=https://yeekox.netlify.app/zh-cn/posts/cache/><span class=title>«</span><br><span>Cache Note</span>
</a><a class=next href=https://yeekox.netlify.app/zh-cn/posts/csapp03/><span class=title>»</span><br><span>三.处理器设计(CSAPP)</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on x" href="https://x.com/intent/tweet/?text=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29&amp;url=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f&amp;hashtags=CSAPP"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f&amp;title=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29&amp;summary=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29&amp;source=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f&title=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on whatsapp" href="https://api.whatsapp.com/send?text=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29%20-%20https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on telegram" href="https://telegram.me/share/url?text=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29&amp;url=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 二.程序的机器级表示(CSAPP) on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e4%ba%8c.%e7%a8%8b%e5%ba%8f%e7%9a%84%e6%9c%ba%e5%99%a8%e7%ba%a7%e8%a1%a8%e7%a4%ba%28CSAPP%29&u=https%3a%2f%2fyeekox.netlify.app%2fzh-cn%2fposts%2fcsapp02%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://yeekox.netlify.app/zh-cn/>Yeelight の 小屋</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>