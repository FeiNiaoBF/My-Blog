---
title: "äºŒ.ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º(CSAPP)"
date: 2023-04-09T20:13:06+08:00
draft: false
tags: [CSAPP]
categories: ["CSAPP","Computer system"]
author: ["Yeelight"]
showtoc: true
---

# å…¥é—¨

## å¾®å¤„ç†å™¨å†å²

### Intelçš„x86

åœ¨è¿™é‡Œæˆ‘æƒ³æ¥ç®€å•çš„è¯´é“è¯´é“å¾®å¤„ç†å™¨çš„å†å²å‘å±•ï¼Œç‰¹æ­¤è¯´æ˜ä¸€ä¸‹æˆ‘ä¸æ˜¯ä¸“ä¸šçš„ğŸ™„ï¼Œå› æ­¤æˆ‘æ²¡æœ‰è¯¦ç»†çš„`æ·±å…¥ç ”ç©¶`ï¼Œå¦‚æœæœ‰ä»»ä½•çš„é”™è¯¯è¯·å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ã€‚

è‡ªä»1971å¹´çš„Intel4004æ—¢ç¬¬ä¸€æ¬¾å¾®å¤„ç†å™¨ï¼Œä¹Ÿæ˜¯å…¨çƒç¬¬ä¸€æ¬¾å¾®å¤„ç†å™¨å¼€å§‹ï¼Œæˆ‘ä»¬äººç±»ç¤¾ä¼šæ ‡å¿—ç€è¿›å…¥å¾®èŠ¯ç‰‡æ—¶ä»£ï¼Œåœ¨è¿™ä¸ªæ—¶ä»£æœ‰ä¸‰ä¸ªä¸»è¦çš„è¶‹åŠ¿ï¼š
- å¤„ç†å™¨çš„ä½é•¿çš„å€å¢
- æŒ‡ä»¤é›†çš„å¿«é€Ÿå‘å±•
- æ—¶é’Ÿé¢‘ç‡çš„å¿«é€Ÿå¢åŠ 

Intelä¹Ÿé€æ­¥å‘å¸ƒäº†`Intel 8008`ä¸€ä¸ª8ä½çš„ï¼Œ`Intel 8086` ä¸€ä¸ª16ä½çš„ï¼Œè‡³æ­¤ï¼ŒIntelçš„x86`å¸å›½`å¼€å§‹äº†ã€‚åœ¨1985å¹´ï¼ŒIntelçš„32ä½å¤„ç†å™¨`IA32`é—®ä¸–ï¼Œè€Œéšç€æ‘©å°”å®šå¾‹ç­‰çš„ç§ç§é™åˆ¶ï¼Œå•æ ¸çš„å¤„ç†å™¨å·²ç»é‡åˆ°ç“¶é¢ˆäº†ï¼Œå„å¤§å…¬å¸ç»§è€Œè½¬å‘äº†é«˜é¢‘ç‡ã€ä½åŠŸè€—çš„å¤šæ ¸å¤„ç†å™¨ï¼Œå¤„ç†å™¨è¿›å…¥å¤šæ ¸/å¤šçº¿ç¨‹æ—¶ä»£ï¼ˆ2005ï¼‰ã€‚

åœ¨ä¸€äº›æ— è®ºæ˜¯ç«äº‰å…³ç³»ï¼Œè¿˜æ˜¯ç ”ç©¶å…³ç³»ï¼Œå¯¼è‡´ç›®å‰çš„å¸‚åœºä¸Šå‡ºç°äº†ä¸¤ç§**æŒ‡ä»¤é›†è®¡ç®—æœº**
- CISC(*Complex instruction set computer*)
- RISC(*Reduced instruction set computer*)

åœ¨åé¢æˆ‘ä¼šå†æåˆ°çš„ã€‚

æˆ‘ä¸çŸ¥é“æœªæ¥çš„å¤„ç†å™¨å‘å“ªä¸ªæ–¹å‘å‘å±•ï¼Œä¹Ÿä¸çŸ¥é“Intelæ˜¯å¦ä¸€ç›´åœ¨å‰æ²¿ï¼ˆAMDï¼šå‘µå‘µï¼‰ï¼Œä½†æˆ‘ç›¸ä¿¡ï¼Œäººç±»çš„æ™ºæ…§ä½¿å¾—ä¸–ç•Œè‡ªç¬¬äºŒæ¬¡å·¥ä¸šé©å‘½ä»¥æ¥å²æ— å‰ä¾‹çš„å¤§å‘å±•ï¼Œåœ¨æœªæ¥ä¸€å®šæœ‰ç€ä¸ä¸€æ ·çš„å‘å±•ã€‚

## åŸºæœ¬æ¦‚å¿µ

>å—¯å—¯ï¼Œå›æ¥å›æ¥ï¼Œä¸å»æƒ³æœªæ¥ï¼Œåšå¥½å½“ä¸‹ã€‚

åœ¨äº†è§£å…·ä½“çš„ä½“ç³»ç³»ç»Ÿå‰ï¼Œæˆ‘ä»¬æ¥äº†è§£åŸºæœ¬çš„ä¸€äº›ä¸œè¥¿ï¼š

![CS61cCS](https://s2.loli.net/2023/04/24/Jp2IxPhfSWjHNZz.png)

ä¸Šé¢æ˜¯æ¥è‡ªCS61cçš„å›¾ç‰‡ï¼Œæˆ‘ä»¬ç°åœ¨è¦äº†è§£å°±æ˜¯æ•´ä¸ªè½¯ä»¶åˆ°ç¡¬ä»¶çš„è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æŠ½è±¡åˆ°å…·ä½“çš„è¿‡ç¨‹ã€‚

**Instructure Set Architecture**ï¼šæŒ‡ä»¤é›†æ¶æ„ (åŒ…æ‹¬æŒ‡ä»¤è§„æ ¼ï¼Œä¸åŒè§„åˆ™å¯„å­˜å™¨ç­‰)ï¼Œç®€ç§°ISAï¼Œå®ƒæ˜¯è½¯ç¡¬ä»¶ä¹‹é—´çš„`æ¡¥æ¢`ã€‚

**Processor**ã€**Memory**ã€**I/O system**ï¼šè¿™æ˜¯ç”±OSè¿›è¡Œæ§åˆ¶çš„ã€‚

æˆ‘ä»¬è¿™ç« ä¸»è¦çš„æ˜¯å­¦ä¹ ISAï¼ŒCSAPPä¸»è¦æ˜¯x86-64çš„CISCæŒ‡ä»¤é›†ï¼ŒCS61cä¸»è¦æ˜¯RISC-Vçš„RISCæŒ‡ä»¤é›†ï¼Œæ²¡é”™ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„æŒ‡ä»¤é›†ï¼Œåœ¨æˆ‘çš„ç¬”è®°é‡Œé¢æˆ‘ä¹Ÿä¼šä¸æ—¶çš„å†™ä¸ŠRISC-Vçš„ä¸€äº›è¡¨ç¤ºæ¥è¯æ˜æˆ‘å­¦ä¹ è¿‡äº†ï¼ˆç¬‘ï¼‰ã€‚

### ä»€ä¹ˆæ˜¯ç¼–è¯‘

```txt
é«˜çº§è¯­è¨€ --> æ±‡ç¼–è¯­è¨€ --> æœºå™¨è¯­è¨€
```

åœ¨æˆ‘ä»¬çš„é›¶ç« çš„æ—¶å€™æˆ‘è¯´è¿‡ä¸€ä¸ª*.cæ–‡ä»¶å¦‚ä½•å˜æˆçš„ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¨‹åºçš„ä¸€ä¸ªä¸»è¦è¿‡ç¨‹ï¼Œå®ƒæœ‰ä¸€ä¸ªæ­¥éª¤æ˜¯**ç¼–è¯‘**ï¼Œè¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬éœ€è¦ç»†ç»†å“å‘³çš„æ­¥éª¤ã€‚

ç¼–è¯‘è¿‡ç¨‹æ˜¯ä¸€ä¸ªç”±æŸä¸ªé«˜çº§è¯­è¨€ï¼ˆæ¯”å¦‚cæ–‡ä»¶ï¼‰ç»è¿‡ç¼–è¯‘å™¨çš„ä¸€ç³»åˆ—çš„å¤„ç†æˆä¸ºå¯è¯»æ€§ä½çš„æ±‡ç¼–è¯­è¨€ã€‚æ¢è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æŠŠæˆ‘ä»¬ååˆ†æ¸…æ¥šæ˜ç™½çš„æŠ½è±¡è¯­è¨€è½¬æ¢æˆæœºå™¨è¯­è¨€ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶æœºå™¨ä¹Ÿä¸çŸ¥é“æ±‡ç¼–è¯­è¨€ï¼‰ï¼Œåœ¨ç»å†æ±‡ç¼–è¯‘å™¨**ç¿»è¯‘**æˆäºŒè¿›åˆ¶ä»£ç ï¼ŒçœŸæ­£çš„æœºå™¨è¯­è¨€ï¼Œæœºå™¨å¯ä»¥è¯»æ‡‚äº†ï¼Œä½†æˆ‘ä»¬çœ‹ä¸æ‡‚ï¼ˆé™¤äº†æŸäº›é»‘å®¢ï¼‰ã€‚

![CALL](https://s2.loli.net/2023/04/24/ARQExTsuyrhdgYO.png)

ä¸Šé¢æ˜¯cs61cä¸­çš„*ä»Cåˆ°æœºå™¨è¯­è¨€*çš„å®Œæ•´è¿‡ç¨‹ï¼Œååˆ†çš„è¯¦ç»†äº†ã€‚ç¨‹åºçš„è¿è¡Œå°±æ˜¯æƒ³åƒæ˜¯ä¸€ä¸ª**ç¿»è¯‘**è¿‡ç¨‹ï¼Œç”¨ä¸Šä¸€äº›æˆ‘ä»¬æ˜æ–‡è§„å®šçš„è¯­æ³•è§„åˆ™ï¼Œä½¿ç”¨ç¼–è¯‘å™¨ï¼ˆGCCç­‰ï¼‰æ¥å½“æˆ‘ä»¬ç¨‹åºå‘˜å’Œæœºå™¨ä¹‹é—´çš„**ç¿»è¯‘å®˜**ã€‚

ç°åœ¨æ¥çœ‹ä¸€çœ‹ä» `Cè¯­è¨€` åˆ°`æœºå™¨ä»£ç `(ä¸€ä¸ªæ•´å‹åŠ æ³•è®¡ç®—çš„æ±‡ç¼–ä»£ç )

```c
  // filename: clcyle_one
#include <stdio.h>
int main(int argc, char const *argv[])
{
Â  Â  int sum = 0;
Â  Â  for (int i = 0; i < 10; ++i)
Â  Â  {
Â  Â  Â  Â  sum += i;
Â  Â  }
Â  Â  return 0;
}
```

ç»è¿‡gccçš„ç¼–è¯‘ï¼Œåœ¨è‡ªå·±çš„Linuxæœºå™¨ä¸Šä½¿ç”¨ä»¥ä¸‹çš„ä»£ç 

```shell
$ gcc -Og -S clcyle_one.c
```

```asm
Â  Â  .file Â  "clcyle_one.c"
Â  Â  .text
Â  Â  .globl Â main
Â  Â  .type Â  main, @function
main:
.LFB7:
Â  Â  .cfi_startproc
Â  Â  movl Â  Â $0, %eax
Â  Â  jmp .L2
.L3:
Â  Â  addl Â  Â $1, %eax
.L2:
    cmpl Â  Â $9, %eax
Â  Â  jle .L3
Â  Â  movl Â  Â $0, %eax
Â  Â  ret
Â  Â  #ï¼ˆä¸ç”¨åœ¨æ„ç±»ä¼¼ .file çš„æŒ‡ä»¤ï¼Œå®ƒä»¬æ˜¯ä¼ªæŒ‡ä»¤ï¼Œ è¦ä»mainçœ‹èµ·ï¼‰
```

ä¸¤è€…ç›¸äº’æ¯”è¾ƒä¸€ä¸‹æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒC è¯­è¨€ä»£ç è¢«å¤„ç†æˆç»Ÿä¸€æ ¼å¼çš„æ±‡ç¼–ä»£ç ï¼Œåœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²å«åšæ“ä½œç¬¦ï¼Œåé¢çš„æ˜¯æºå’Œç›®çš„`å¯„å­˜å™¨`ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¤§ç©æ„ğŸ˜£ï¼‰ã€‚æ“ä½œå’Œæ“ä½œæ•°æ˜ç¡®ï¼Œåœ¨ä¸‹é¢æˆ‘ä»¬ä¼šåˆ°ä¸åŒçš„æ“ä½œç¬¦åˆ†ç±»åˆ†æï¼ˆæˆ‘æƒ³æŠŠRISC-Vçš„åŠ å…¥ä½œæ¯”è¾ƒï¼‰ï¼Œè®°ä½ä¸€ä¸ªæ¡ä»¶ï¼Œ`è¯»å–`/`è¿ç®—æ“ä½œ`æ˜¯ä¸€ä¸ª**çº¿æ€§é€å¥é€æ¬¡**çš„æ“ä½œï¼ŒPCæŒ‡ä»¤æ˜¯æœ‰ç°æ€å’Œæ¬¡æ€ä¹‹åˆ†ã€‚

## å¤„ç†å™¨çš„å·¥ä½œ

åœ¨æˆ‘ä»¬å¯¹æ“ä½œæŒ‡ä»¤åˆ†ç±»è®¨è®ºä¹‹å‰æˆ‘ä»¬æ¥è®¤è¯†å¤„ç†å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œ

![x86-64](https://s2.loli.net/2023/04/24/3isvAmjMY8E9IgP.jpg)

![cs61c cpu](https://s2.loli.net/2023/04/24/Fzb3uHQBLTlqOgD.png)

ä¸Šé¢çš„å›¾ç‰‡(åˆ†åˆ«æ¥è‡ªCSappå’ŒCS61c)ååˆ†æ¸…æ¥šçš„å±•ç¤ºäº†å¤„ç†å™¨å¯¹äºå­˜æ”¾åœ¨ä¸»å­˜é‡Œé¢çš„æŒ‡ä»¤æœ‰ç€ä»€ä¹ˆæ ·çš„æ“ä½œï¼Œä¸»è¦çš„å°±ä¸¤ç‚¹**å­˜ã€è¯»å–å€¼**å’Œ**è®¡ç®—**ã€‚åœ¨x86-64é‡Œé¢è¿˜æœ‰ä¸€ä¸ªå«ä½œ**æ¡ä»¶ç **çš„ä¸œä¸œï¼Œæˆ‘ä¼šåœ¨ä¸‹é¢è¯´åˆ°å› ä¸ºæˆ‘ä¹Ÿç¬¬ä¸€æ¬¡çœ‹è§è¿™ä¸ªã€‚

è¿™æ˜¯ä¸€ä¸ª**CPUåˆ°Memory**çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå…·ä½“çš„æ˜¯ä¸€ä¸ªå¤„ç†å™¨ä»å†…å­˜æŸä¸ªåœ°å€å–å€¼ï¼ˆæœ‰æ•°æ®å’ŒæŒ‡ä»¤ï¼‰æ‹¿åˆ°**CPU**é‡Œçš„**å¯„å­˜å™¨**é€šè¿‡**ALU**è®¡ç®—ï¼Œå†æ ¹æ®**PC**é€‰æ‹©ä¸‹ä¸€æ­¥ã€‚

- **ç¨‹åºè®¡æ•°å™¨**(PC, Program counter) - å­˜ç€ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œåœ¨ x86-64 ä¸­ç§°ä¸º RIPã€‚
- **å¯„å­˜å™¨**(Register) - ç”¨æ¥å­˜å‚¨æ•°æ®ä»¥ä¾¿æ“ä½œã€‚
- **æ¡ä»¶ä»£ç **(Codition codes) - é€šå¸¸ä¿å­˜æœ€è¿‘çš„ç®—æœ¯æˆ–é€»è¾‘æ“ä½œåçš„ä¿¡æ¯ï¼Œç”¨æ¥åšæ¡ä»¶è·³è½¬çš„æ¡ä»¶ã€‚

## ä»€ä¹ˆæ˜¯ISA

**Instruction Set Architecture** (æŒ‡ä»¤é›†æ¡†æ¶) æ˜¯åŒ…å«äº†é’ˆå¯¹æŸä¸ªç‰¹å®šå¤„ç†å™¨æ‰§è¡Œçš„åŸºæœ¬æ“ä½œç ï¼ˆ*opcode*ï¼‰ï¼Œé‡Œé¢æ˜¯åŸºæœ¬å‘½ä»¤ï¼Œåœ¨æˆ‘ä»¬å­¦ä¹ çš„`x86-64`ã€`RISC-V`éƒ½æœ‰ä¸åŒçš„ISAã€‚

ä¸ºäº†å­¦ä¹ æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¦æŠŠISAæ ¹æ®ä½¿ç”¨çš„æ–¹æ³•ä¸åŒè¿›è¡Œä¸åŒçš„åˆ†ç±»ã€‚

- èµ„æ–™å¤„ç†ä¸è®¿é—®æ“ä½œ
- ç®—æœ¯é€»è¾‘æ“ä½œ
- æ§åˆ¶è¿‡ç¨‹æ“ä½œ

åœ¨ä¸‹é¢æˆ‘ä¼šä¸€ä¸€åˆ†æã€‚

## CISC&RISCåŒºåˆ«

CISC(*Complex instruction set computer*)
> å…¼å®¹æ€§æ€§å¼ºï¼ŒæŒ‡ä»¤ç¹å¤šï¼Œé•¿åº¦å¯å˜ï¼Œç”±å¾®ç¨‹åºå®ç°ã€‚
> ä»£è¡¨ï¼šx86-64

RISC(*Reduced instruction set computer*)
> æŒ‡ä»¤å°‘ï¼Œä½¿ç”¨é¢‘ç‡æ¥è¿‘ï¼Œä¸»è¦æ˜¯ä¾é ç¡¬ä»¶å®ç°ï¼ˆé€šç”¨å¯„å­˜å™¨ã€ç¡¬å¸ƒçº¿é€»è¾‘æ§åˆ¶ï¼‰ã€‚
> ä»£è¡¨ï¼šRISC-V


# å¼€å§‹å¿«ä¹çš„æ±‡ç¼–

## æ•´å‹å¯„å­˜å™¨

![Reg](https://s2.loli.net/2023/04/24/pYIjkJMEBKc413b.png)

åœ¨x86-64ä¸Šæœ‰16ä¸ª64ä½çš„**é€šç”¨å¯„å­˜å™¨**ï¼›å¯¹äºæ¯ä¸ªå¯„å­˜å™¨çš„ä½32ã€16å’Œ8ä½å¯ä»¥ç‹¬ç«‹åœ°é€šè¿‡å…¶ä»–ä¸åŒæŒ‡ä»¤åç§°è®¿é—®ï¼ŒåŸåˆ™ä¸Šï¼Œå‡ ä¹ä»»ä½•å¯„å­˜å™¨éƒ½å¯ä»¥ç”¨äºä¿å­˜å‡ ä¹ä»»ä½•é€»è¾‘å’Œç®—æœ¯æ“ä½œçš„æ“ä½œæ•°ï¼Œä½†æœ‰äº›å…·æœ‰ç‰¹æ®Šæˆ–å—é™åˆ¶çš„ç”¨é€”ã€‚

ä¸€ä¸ªå¯„å­˜å™¨æœ‰ç€64ä½ã€32ä½ã€16ä½ã€8ä½è¿™å¯ä»¥å¯¹ä»¥å‰çš„ä½ä½ç¨‹åºå‘ä¸‹å…¼å®¹ã€‚

æŒ‰ç…§æƒ¯ä¾‹ï¼Œ%rspè¢«ä¿ç•™ä½œä¸ºå †æ ˆæŒ‡é’ˆï¼Œå¹¶ä¸”å› ä¸ºä¸€äº›æŒ‡ä»¤ï¼ˆä¾‹å¦‚pushã€popã€callï¼‰éšå«ä½¿ç”¨å®ƒã€‚%rspæŒ‡å‘æœ€ä½å ç”¨çš„å †æ ˆä½ç½®ï¼ˆè€Œä¸æ˜¯ä¸‹ä¸€ä¸ªè¦ä½¿ç”¨çš„ä½ç½®ï¼‰ã€‚

å¯„å­˜å™¨%rbpæœ‰æ—¶è¢«ç”¨ä½œå¸§æŒ‡é’ˆï¼Œå³å½“å‰å †æ ˆå¸§çš„åŸºå€ã€‚æŒ‡ä»¤è®¡æ•°å™¨å¯„å­˜å™¨ï¼ˆï¼…ripï¼‰ æŒ‡å‘è¦æ‰§è¡Œçš„ä¸‹ä¸€æ¡å‘½ä»¤; ç¨‹åºå‘˜æ— æ³•ç›´æ¥è®¿é—®å®ƒ, ä½†æ˜¯å¤§é‡åœ°è¢«ç”¨ä½œåŸºäºä½ç½®æ— å…³ä»£ç å¯»å€çš„åŸºç¡€ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–æŒ‡ä»¤éšå«åœ°ä½¿ç”¨æŸäº›å¯„å­˜å™¨ï¼›ä¾‹å¦‚ï¼Œæ•´æ•°ä¹˜æ³•å’Œé™¤æ³•æŒ‡ä»¤éœ€è¦%raxå’Œ%rdxã€‚

## æ•°æ®ç±»å‹

æ—¢ç„¶æˆ‘ä»¬çš„å¯„å­˜å™¨æœ‰ç€ä¸åŒä½çš„è¡¨ç¤ºï¼Œé‚£å°±æ˜¯è¯´å¤„ç†å™¨åœ¨æ“ä½œä¸åŒçš„æ•°æ®æ—¶ä½¿ç”¨ç€ä¸åŒä½æ•°çš„å¯„å­˜å™¨æ¥æé«˜é€Ÿç‡ã€‚

æˆ‘ä»¬é’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹ä½¿ç”¨ä¸åŒçš„**suffix**å’Œ**size**ï¼š

| Data type | suffix | size | word|
| :---: | :---: | :---: | :---: |
| char | b | 1B | Byet |
| short | w | 2B | 1word |
| int | l | 4B | 2word |
| long | q | 8B | 4word |
| char* | q | 8B | 4word |
| float | s | 4B | 2word |
| double | l | 8B | 4word |

ä¸Šé¢çš„**suffix**åˆ—æ˜¾ç¤ºäº†åœ¨ GNU æ±‡ç¼–ç¨‹åºç”¨æ¥æŒ‡å®šé€‚å½“å¤§å°çš„å˜ä½“çš„å­—æ¯æŒ‡ç¤ºã€‚

è€Œä¸€ä¸ªæ–°å•ä½**word**æ˜¯ç›¸ç­‰äº2ä¸ªå­—èŠ‚çš„å¤§å°ã€‚

## æ“ä½œæ•°æŒ‡ç¤ºç¬¦

### æ“ä½œæ•°åŸºæœ¬

ä»¥ä¸‹çš„éƒ½æ˜¯åœ¨æ“ä½œæ•°é‡Œé¢ä¸»è¦æ•°å€¼è¡¨è¾¾çš„æ„æ€ï¼š

- **Imm**   refers to a constant value, e.g. 0x8048d8e or 48
- **r**     refers to a register.  e.g. %rax or %edi
- **R[r]**  refers to the value stored in register address r.
- **M[i]**  refers to the value stored at memory address i .

ä¸åŒçš„æ ¼å¼è¡¨ç¤ºä¸åŒçš„ç±»å‹ã€‚

### å¯»å€

> å¾ˆé‡è¦ï¼ï¼ï¼

å¯¹äºå¯»å€æ¥è¯´ï¼Œæ¯”è¾ƒé€šç”¨çš„æ ¼å¼æ˜¯ï¼š` Imm(Rb, Ri, S) -> M[R[Rb] + S*R[Ri]+ Imm] `ï¼Œå…¶ä¸­ï¼š

- **Imm** - å¸¸æ•°åç§»é‡
- **Rb** - åŸºå¯„å­˜å™¨
- **Ri** - ç´¢å¼•å¯„å­˜å™¨ï¼Œä¸èƒ½æ˜¯ %rsp
- **S** - ç³»æ•°

![OperandSpecifiers](https://s2.loli.net/2023/04/24/LPK7kRoNwmFVfi2.png)

## æŒ‡ä»¤

æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ä¸åŒåˆ†ç±»çš„æŒ‡ä»¤æ ¼å¼ï¼Œæˆ‘æŒ‰ä¹¦ä¸Šçš„é¡ºåºæ¥è¯´çš„ï¼Œå®ƒä¹Ÿæ˜¯æŒ‰æˆ‘ä»¬åœ¨å¹³æ—¶ä½¿ç”¨çš„é¢‘ç‡é¡ºåºæ¥æ•™çš„ã€‚

å¤§å¤šæ•°çš„æŒ‡ä»¤éƒ½æ˜¯ä½¿ç”¨ä¸Šæ–‡æè¿‡çš„ **suffix** æ¥æ˜¾ç¤ºæ“ä½œæ•°çš„å¤§å°çš„ã€‚

### æ•°æ®ç§»åŠ¨æŒ‡ä»¤

å¯¹äº **mov** æŒ‡ä»¤æ¥è¯´ï¼Œéœ€è¦**æºæ“ä½œæ•°**å’Œ**ç›®æ ‡æ“ä½œæ•°**ã€‚æŒ‡ä»¤çš„å…·ä½“æ ¼å¼å¯ä»¥è¿™æ ·å†™ `mov? Src, Dest`ï¼Œç¬¬ä¸€ä¸ªæ˜¯æºæ“ä½œæ•°ï¼Œç¬¬äºŒä¸ªæ˜¯ç›®æ ‡æ“ä½œæ•°

```asm
mov[b|w|l|q] Src, Dest                             # å°†srcç§»åŠ¨åˆ°dest
movs[bw|bl|bq|wl|wq|lq] Src, Dest                  # å¸¦ç¬¦å·æ‰©å±•çš„ç§»åŠ¨
movz[bw|bl|bq|wl|wq] Src, Dest                     # å¸¦é›¶æ‰©å±•çš„ç§»åŠ¨
movabsq imm, r                                     # ç§»åŠ¨ç»å¯¹å››å­—ï¼ˆimmä¸º64ä½ï¼‰

cltq Src, Dest                                     # æŠŠ%eax ç¬¦å·æ‰©å±•åˆ°%rax
```

åœ¨ä½¿ç”¨ **mov** æŒ‡ä»¤çš„æ—¶å€™éœ€è¦å€¼å¾—æ³¨æ„çš„æ˜¯æˆ‘ä»¬çš„æºå€¼å’Œç›®çš„å€¼çš„é€‰å€æ˜¯æœ‰æ ‡å‡†çš„, æºæ“ä½œæ•°å¯ä»¥æ˜¯ç«‹å³æ•°ã€å¯„å­˜å™¨å€¼æˆ–å†…å­˜å€¼çš„ä»»æ„ä¸€ç§ï¼Œä½†ç›®æ ‡æ“ä½œæ•°åªèƒ½æ˜¯å¯„å­˜å™¨å€¼æˆ–å†…å­˜å€¼

|Src| Dest |
| :--: | :--: |
| imm | Rag |
| imm | Mem |
|Reg| Reg |
|Reg|Mem|
|Mem|Reg|

> åªæœ‰è¿™äº”ç§çš„é€‰æ‹© ï¼Œ å¦‚æœè¦æŠŠMem -> Mem çš„å€¼ç§»åŠ¨ï¼Œéœ€è¦ä¸¤æ­¥ Mem -> Reg -> Mem


### ç¨‹åºæ ˆæŒ‡ä»¤

è¿™ä¸€éƒ¨åˆ†å°±åªæœ‰ä¸¤ä¸ªä¸»è¦çš„æŒ‡ä»¤ï¼Œä½†æ˜¯æ— æ¯”çš„é‡è¦ã€‚å¯ä»¥æŠŠæ•°æ®å‹å…¥ç¨‹åºæ ˆä¸­ï¼Œä»¥åŠåœ¨æ ˆä¸­å¼¹å‡ºï¼Œç¨‹åºæ ˆåœ¨è¿‡ç¨‹è°ƒç”¨ä¸­èµ·è‡³å…³é‡è¦çš„ä½œç”¨ã€‚

```asm
pushq  Src                    # å°†4wordçš„æ•°æ®å‹å…¥æ ˆï¼Œå¹¶æŠŠ%rsp - 8 -> %rsp

popq  Dest                    # å°†4wordçš„æ•°æ®å¼¹å…¥æ ˆï¼Œå¹¶æŠŠ%rsp + 8 -> %rsp
```

å¯¹äºç¨‹åºæ ˆæŒ‡ä»¤ååˆ†é‡è¦çš„ä¸€ç‚¹æ˜¯æˆ‘ä»¬å¯¹å†…å­˜çš„å˜åŒ–è¦æ³¨æ„ã€‚åœ¨ç¨‹åºå‘˜çš„çœ¼é‡Œå†…å­˜æ˜¯ä¸€ä¸ªæœ‰é™çš„æ•°ç»„ï¼Œæˆ‘ä»¬åœ¨æŠŠå¯„å­˜å™¨é‡Œé¢çš„æ•°æ® `push` è¿›å†…å­˜çš„æ—¶å€™æ ˆæŒ‡é’ˆï¼ˆ%rspï¼‰è¦å‘ç€åœ°å€å‡å°çš„æ–¹å‘ç§»åŠ¨ï¼Œè¿™å°±æ˜¯ `%rsp - 8` çš„åŸå› ã€‚

å›¾ç‰‡

### ç®—æœ¯ä¸é€»è¾‘æŒ‡ä»¤

å¯¹äºç®—æœ¯æŒ‡ä»¤æˆ‘ä»¬æƒ³èµ·CPUä¸­æœ€é‡è¦çš„éƒ¨ä»¶ `ALU` ç®—æœ¯é€»è¾‘å•å…ƒï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„è¿™äº›æŒ‡ä»¤é€šè¿‡
 `opcode` æ¥åœ¨å¤šè·¯é€‰æ‹©ä¸Š `æŒ‡æŒ¥` ALUæ­£ç¡®çš„ä½¿ç”¨ç®—æœ¯ã€‚
 > æ³¨ï¼šä¸‹é¢çš„æ‰€æœ‰æŒ‡ä»¤éƒ½å¯ä»¥æ ¹æ®æ•°æ®ç±»å‹åŠ  suffix (b/w/l/q)

#### Unary Operation(ä¸€å…ƒæ“ä½œ)

```asm
inc Deat         Deat+1->Deat           # æŒ‰1é€’å¢
dec Deat         Deat-1->Deat           # æŒ‰1é€’å‡
neg Deat         -Deat->Deat    (å–å)  # ç®—æœ¯å–å
not Deat         ~Deat-1->Deat ï¼ˆå–è¡¥ï¼‰ # æŒ‰ä½å–å
```

ä¸€å…ƒæ“ä½œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œå³åšæºä¹Ÿæ˜¯ç›®çš„ã€‚å¯ä»¥æ˜¯`Reg or Mem` ã€‚

#### Binary Operation(äºŒå…ƒæ“ä½œ)

```asm
leaq Sï¼ŒD      &S -> D        # å°†æºåœ°å€çš„æœ‰æ•ˆåœ°å€åŠ è½½åˆ°ç›®æ ‡ä¸­
add Sï¼ŒD      D + S -> D      # å°†æºåŠ åˆ°ç›®æ ‡ä¸­
sub Sï¼ŒD      D - S -> D      # å°†æºä»ç›®æ ‡ä¸­å‡å»
imul Sï¼ŒD     D * S -> D      # ç›®æ ‡ä¹˜ä»¥æº
xor Sï¼ŒD      D ^ S -> D      # æŒ‰ä½å¼‚æˆ–ç›®æ ‡å’Œæ¥æº
or Sï¼ŒD       D | S -> D      # æŒ‰ä½æˆ–ç›®æ ‡å’Œæ¥æº
and S, D      D & S -> D      # æŒ‰ä½ä¸ç›®æ ‡å’Œæ¥æº

```

å¯¹äºç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªä¸éœ€è¦å†è¯´äº†ï¼Œéƒ½æ˜¯å­—é¢æ„æ€ã€‚ä¸»è¦æ¥è¯´ä¸€è¯´ `leaq` è¿™ä¸ªæŒ‡ä»¤ã€‚

Load effective address(åŠ è½½æœ‰æ•ˆåœ°å€) , leaq æœ‰ä¸¤ä¸ªä½œç”¨ï¼š
> - å°†å…¶æºæ“ä½œæ•°çš„æœ‰æ•ˆåœ°å€ï¼ˆè€Œä¸æ˜¯è¯¥åœ°å€å¤„çš„æ•°æ®ï¼‰åŠ è½½åˆ°å…¶ç›®æ ‡å¯„å­˜å™¨ä¸­
>  åœ¨ Cè¯­è¨€é‡Œé¢å°±æ˜¯ `&S` , è¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥ç»™ä¸‹é¢çš„å†…å­˜äº§ç”ŸæŒ‡é’ˆã€‚
> - ä¹Ÿå¯ç”¨äºæ‰§è¡Œä¸å¯»å€æ— å…³çš„ç®—æœ¯è¿ç®—ã€‚ï¼ˆegï¼š `leaq (%rdi, %rsi, 4), %rax` ç›¸åŒä¸ `x + 4*y ` )

#### Shift Operations(ç§»ä½æ“ä½œ)

```asm
sal[b|w|l|q] imm,d   d = d << imm   # å·¦ç§»immä½
sar[b|w|l|q] imm,d   d = d >> imm   # ç®—æœ¯å³ç§»immä½
shr[b|w|l|q] imm,d   d = d >> imm   # é€»è¾‘å³ç§»immä½
```

#### Special Arithmetic Operations(ç‰¹æ®Šç®—æœ¯æ“ä½œ)

```asm
imulq S                  # æœ‰ç¬¦å·å…¨ä¹˜æ³•   å››å­—åˆ°å…«å­—
mulq S                   # æ— ç¬¦å·å…¨ä¹˜æ³•   å››å­—åˆ°å…«å­—
idivq S                  # æœ‰ç¬¦å·å…¨é™¤æ³•   å…«å­—åˆ°å››å­—
divq S                   # æ— ç¬¦å·å…¨é™¤æ³•   å…«å­—åˆ°å››å­—
cltd                     # sign extend %eax into %edx::%eax
cqto                     # sign extend %rax into %rdx::%rax
```

åœ¨ç‰¹æ®Šç®—æœ¯é‡Œé¢ï¼Œè¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†è¡¥ç çš„ä¹˜é™¤æœ‰æ‰©å±•ã€‚ç”±ä¸¤ä¸ª64ä½çš„åˆ°å…¨128ä½çš„ä¹˜ç§¯å’Œæ•´æ•°é™¤æ³•çš„æˆªæ–­ã€‚

é™¤æ³•éœ€è¦ç‰¹æ®Šçš„å®‰æ’ï¼š`idivï¼ˆæœ‰ç¬¦å·ï¼‰` å’Œ `divï¼ˆæ— ç¬¦å·ï¼‰` æ“ä½œåœ¨2nå­—èŠ‚è¢«é™¤æ•°å’Œnå­—èŠ‚é™¤æ•°ä¸Šï¼Œäº§ç”Ÿä¸€ä¸ªnå­—èŠ‚å•†å’Œnå­—èŠ‚ä½™æ•°ã€‚è¢«é™¤æ•°æ€»æ˜¯å­˜åœ¨äºä¸€å¯¹å›ºå®šå¯„å­˜å™¨ä¸­ï¼ˆ32ä½æƒ…å†µä¸‹ä¸º%edxå’Œ%eaxï¼›64ä½æƒ…å†µä¸‹ä¸º%rdxå’Œ%raxï¼‰ï¼›é™¤æ•°ä½œä¸ºæŒ‡ä»¤ä¸­çš„æºæ“ä½œæ•°æ¥æŒ‡å®šã€‚å•†æ”¾åœ¨ï¼…eaxï¼ˆresp. ï¼…raxï¼‰ä¸­; ä½™æ•°æ”¾åœ¨ï¼…edxï¼ˆresp. ï¼…rdxï¼‰ä¸­ã€‚å¯¹äºæœ‰ç¬¦å·çš„é™¤æ³•ï¼Œä½¿ç”¨cltdï¼ˆresp.ctqoï¼‰æŒ‡ä»¤æ¥å‡†å¤‡ï¼…edx(resp.%rdx)ï¼Œå¹¶å°†å…¶ä¸ï¼…eax(resp.%rax)çš„ç¬¦å·æ‰©å±•é…åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœaã€bã€cæ˜¯ä¿å­˜å››ä¸ªå­—é•¿çš„å†…å­˜ä½ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åºåˆ—è®¾ç½®c = a / bï¼š

```asm
    movq a(%rip), %rax
    ctqo
    idivq b(%rip)
    movq %rax, c(%rip)
```

ä¸Šæ–‡æ¥è‡ªæ–‡æ¡£ï¼‰

### æ§åˆ¶æŒ‡ä»¤

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„éƒ½æ˜¯é¡ºåºä¸€æ¡æ¥ç€ä¸€æ¡çš„æ“ä½œçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„cè¯­è¨€é‡Œé¢è¿˜æœ‰æ¡ä»¶è¯­å¥ï¼ˆifï¼‰ã€å¾ªç¯è¯­å¥ï¼ˆwhileï¼‰ã€åˆ†æ”¯è¯­å¥ï¼ˆswitchï¼‰ç­‰ï¼Œå¾ˆæ˜æ˜¾éƒ½ä¸æ˜¯é¡ºåºçš„ï¼Œè¦è¿›è¡ŒæŸç§**è·³è½¬**ï¼Œè€Œè¿™ç§è·³è½¬æ˜¯ç”±æœºå™¨ä»£ç æ¥å®ç°çš„ï¼Œæ ¹æ®æµ‹è¯•æ•°æ®å€¼æ¥åˆ¤æ–­æœºå™¨æ­¤æ—¶æ˜¯å¦æ”¹å˜æ§åˆ¶æµã€‚

#### æ¡ä»¶ç 

å¥½äº†ï¼Œåˆ°æˆ‘ä»¬å¿ƒå¿ƒå¿µçš„**æ¡ä»¶ç **äº†ï¼Œæ¡ä»¶ç åœ¨CPUä¸­æ˜¯æœ‰å•ç‹¬çš„**æ¡ä»¶ç å¯„å­˜å™¨**ï¼Œä½†æ˜¯å®ƒåªæœ‰å•ä¸ªä½ï¼Œå®ƒä»¬æè¿°çš„æ˜¯è·ç¦»æœ€è¿‘çš„ç®—æœ¯å’Œé€»è¾‘æ“ä½œçš„æŸäº›å±æ€§ï¼ŒCPUæ ¹æ®æ¡ä»¶ç å¯„å­˜å™¨æ¥æ–­å®šæ˜¯å¦æ‰§è¡Œåˆ†æ”¯è·³è½¬ã€‚ä»¥ä¸‹æ˜¯å››ç§æ¡ä»¶ç ï¼š

- **ZF** result was Zero
- **CF** result caused Carry out of most significant bit (unsigned)
- **SF** result was negative (Sign bit was set)
- **OF** result caused (**signed**) Overflow ï¼ˆnegative overflow, positive overflowï¼‰

> leaq æŒ‡ä»¤ä¸æ”¹å˜ä»»ä½•çš„æ¡ä»¶ç ã€‚è€Œä¸æ˜¯æ‰€æœ‰çš„æŒ‡ä»¤éƒ½è¦æ”¹å˜ï¼Œå¦‚**xor**å¯¹äºCFã€OFä¼šè®¾ç½®ä¸º0ã€‚

æŒ‡ä»¤é›†ä¸­ä¹Ÿæœ‰ä¸“é—¨æ¥è®¾ç½®æ¡ä»¶ç çš„æŒ‡ä»¤ï¼Œå®ƒä»¬ä¸ä¼šæ”¹å˜ä»»ä½•çš„å…¶ä»–å¯„å­˜å™¨ï¼Œåªä¼šæ”¹å˜æ¡ä»¶ç ï¼š

```asm
cmp[b|w|l|q]  s2,s1                         # æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼ŒS1 - S2 ç”¨å‡æ³•çš„æ–¹æ³•æ¥æ¯”è¾ƒ
test[b|w|l|q] s2,s1                         # æµ‹è¯•ä¸¤ä¸ªå€¼ï¼ŒS1 & S2 å¯ä»¥æ¥æ£€æŸ¥æ˜¯è´Ÿoræ­£ï¼Œä¹Ÿå¯ä»¥æ¯”è¾ƒå…·ä½“ä½çš„å€¼
```

å…¶å®cmpå’Œtestæœ‰æ—¶æ˜¯ååˆ†å¥½ç”¨çš„æµ‹è¯•æŒ‡ä»¤ï¼Œæ¯”å¦‚åœ¨å¯¹ï¼ˆx == 0ï¼‰çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ `cmpl %eax, %eax` æˆ–è€… `testl %eax, %eax` æ¥ä¸è‡ªå·±æ¯”è¾ƒæ¥è®¾ç½®**ZF**æ¡ä»¶ç ï¼Œä¹Ÿç”¨æ¥åˆ¤æ–­ `%eax` æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚

#### è®¿é—®æ¡ä»¶ç 

æ¡ä»¶ç é€šå¸¸æ˜¯ä¸ä¼šç›´æ¥è¯»å–çš„ï¼Œåœ¨x86ä¸­é‡‡ç”¨ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š

- å¯ä»¥æ ¹æ®æ¡ä»¶ç çš„æŸç§ä½é€»è¾‘ç»„åˆï¼Œå°†ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º0 æˆ–1ã€‚
- å¯ä»¥æ¡ä»¶è·³è½¬åˆ°ç¨‹åºçš„æŸä¸ªå…¶ä»–çš„éƒ¨åˆ†ã€‚
- å¯ä»¥æœ‰æ¡ä»¶åœ°ä¼ é€æ•°æ®ã€‚

> è¿™é‡Œä¼šå‘ç°ç”¨äº†ä½çš„é€»è¾‘è®¡ç®—æ¥ç¡®è®¤å¤§äºæˆ–å°äºç­‰æƒ…å†µã€‚ï¼ˆéœ€è¦å¥½å¥½çœ‹çœ‹ç¬¬äºŒç« ï¼‰

1. ç¬¬ä¸€ç‚¹çš„å®ç° **SETæŒ‡ä»¤**

```asm
sete / setz   D        Set if equal/zero                               ZF
setne / setnz D        Set if not equal/nonzero                      ~ ZF
sets          D        Set if negative                                 SF
setns         D        Set if nonnegative                            ~ SF
setg / setnle D        Set if greater (signed)                 ~ (SF ^ 0F)& ~ ZF
setge / setnl D        Set if greater or equal (signed)           ~ (SF ^ 0F)
setl / setnge D        Set if less (signed)                           SF^0F
setle / setng D        Set if less or equal                       (SF ^ OF)|ZF
seta / setnbe D        Set if above (unsigned)                     ~ CF& ~ ZF
setae / setnb D        Set if above or equal (unsigned)              ~ CF
setb / setnae D        Set if below (unsigned)                         CF
setbe / setna D        Set if below or equal (unsigned)               CF|ZF
```

SETæŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤æ ¹æ®æ¡ä»¶ç çš„å„ç§ç»„åˆå°†ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º **0æˆ–1**ã€‚

2. ç¬¬äºŒç‚¹çš„å®ç° **JumpæŒ‡ä»¤**

```asm
jmp Label             Jump to label                                   true
jmp *Operand          Jump to specified location                      true
je / jz Label         Jump if equal/zero                               ZF
jne / jnz Label       Jump if not equal/nonzero                       ~ ZF
js Label              Jump if negative                                 SF
jns Label             Jump if nonnegative                             ~ SF
jg / jnle Label       Jump if greater (signed)                ~ (SF ^ 0F)& ~ ZF
jge / jnl Label       Jump if greater or equal (signed)           ~ (SF ^ 0F)
jl / jnge Label       Jump if less (signed)                           SF^0F
jle / jng Label       Jump if less or equal                       (SF ^ OF)|ZF
ja / jnbe Label       Jump if above (unsigned)                    ~ CF& ~ ZF
jae / jnb Label       Jump if above or equal (unsigned)               ~ CF
jb / jnae Label       Jump if below (unsigned)                         CF
jbe / jna Label       Jump if below or equal (unsigned)              CF|ZF
```

è·³è½¬(jump) æŒ‡ä»¤ä¼šå¯¼è‡´æ‰§è¡Œåˆ‡æ¢åˆ°ç¨‹åºä¸­ä¸€ä¸ªå…¨æ–°çš„ä½ç½®ã€‚åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè¿™äº›è·³è½¬çš„ç›®çš„åœ°é€šå¸¸ç”¨ä¸€ä¸ªæ ‡å·(**Label**) æŒ‡æ˜ã€‚åœ¨ä¸‹ä¸€ä¸ªæ ‡é¢˜å†ç»§ç»­æ·±å…¥jumpæŒ‡ä»¤ã€‚

3. ç¬¬ä¸‰ç‚¹çš„å®ç° **cmoveæŒ‡ä»¤**

```asm
cmove / cmovz   S, D   Move if equal/zero                               ZF
cmovne / cmovnz S, D   Move if not equal/nonzero                       ~ ZF
cmovs           S, D   Move if negative                                 SF
cmovns          S, D   Move if nonnegative                             ~ SF
cmovg / cmovnle S, D   Move if greater                (signed)    ~ (SF ^ 0F)& ~ ZF
cmovge / cmovnl S, D   Move if greater or equal       (signed)      ~ (SF ^ 0F)
cmovl / cmovnge S, D   Move if less (signed)                           SF^0F
cmovle / cmovng S, D   Move if less or equal                       (SF ^ OF)|ZF
cmova / cmovnbe S, D   Move if above (unsigned)                     ~ CF& ~ ZF
cmovae / cmovnb S, D   Move if above or equal        (unsigned)        ~ CF
cmovb / cmovnae S, D   Move if below                 (unsigned)         CF
cmovbe / cmovna S, D   Move if below or equal        (unsigned)        CF|ZF
```

æ¡ä»¶ä¼ é€æŒ‡ä»¤, ä½†ä¼ é€æ¡ä»¶æ»¡è¶³çš„æ—¶å€™,æŒ‡ä»¤æŠŠ`S`å¤åˆ¶åˆ°`D`ä¸­ã€‚

#### Cè¯­è¨€ä¸­çš„æ¡ä»¶åˆ†æ”¯

ç°åœ¨æ¥è¿›è¡Œå¯¹Cè¯­è¨€ä¸­ä¸€äº›å¸¸è§çš„åˆ†æ”¯è·³è½¬æ“ä½œæ¥çœ‹çœ‹ç¿»è¯‘åçš„æœºå™¨ä»£ç ã€‚

##### if-else

C è¯­è¨€ä¸­çš„æ±Ÿ-else è¯­æ—¬çš„é€šç”¨å½¢å¼æ¨¡æ¿å¦‚ä¸‹ï¼š

```c
if (test-expr)
    then-statement
else
    els-statement
```

æ±‡ç¼–å™¨å·¥ä½œæ˜¯ä¸º `then-statement` å’Œ `else-statement` äº§ç”Ÿå„è‡ªçš„ä»£ç å—ã€‚å®ƒä¼šæ’å…¥æ¡ä»¶å’Œæ— æ¡ä»¶åˆ†æ”¯ï¼Œä»¥ä¿è¯èƒ½æ‰§è¡Œæ­£ç¡®çš„ä»£ç å—ã€‚

çœ‹ä¸€ä¸ªä¾‹å­

```c

long absdiff(long x, long y)
{
    long result;
    if (x < y)
        result = y-x;
    else
        result = x-y;
    return result;
}
```

```c
long absdiff_es(long x, long y)
{
    long result;
    if (x > y)
        result = x-y;
    else
        result = y-x;
    return result;
}
```

åˆ†åˆ«äº§ç”Ÿçš„æ±‡ç¼–ä»£ç 

```asm
# x in %rdi, y in %rai
absdiff :
    movq %rsi, %rax
    subq %rdi, %rax          rval = y-x
    movq %rdi, %rdx
    subq %rsi, %rdx          eval = x-y
    cmpq %rsi, %rdi          æ¯”è¾ƒ x:y
    cmovge %rdx, %rax       If >=, rval = eval
    ret                      Return tval
```

```asm
absdiff_es:
    cmpq    %rsi, %rdi
    jle     .L4
    movq    %rdi, %rax
    subq    %rsi, %rax
    ret
.L4:    # x <= y
    movq    %rsi, %rax
    subq    %rdi, %rax
    ret
```

> [ä¸ºä»€ä¹ˆåŸºäºæ¡ä»¶æ•°æ®ä¼ é€(1)çš„ä»£ç ä¼šæ¯”åŸºäºæ¡ä»¶æ§åˆ¶è½¬ç§»(2)çš„ä»£ç æ€§èƒ½è¦å¥½ï¼Ÿ]
##### while

while è¯­å¥çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š

```c
while (test-expr)
    body-statement
```

ä¾‹å­

```c
long fact_while(long n)
{
    long result = 1;
    while (n > 1) {
        result *= n;
        n = n-1;
    }
    return result;
}
```

##### do-while

do-while è¯­å¥çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š

```c
do
    body-statement
    while (test-expr);
```

ä¾‹å­

```c
// Do While çš„ C è¯­è¨€ä»£ç 
long pcount_do(unsigned long x)
{
    long result = 0;
    do {
        result += x & 0x1;
        x >>= 1;
    } while (x);
    return result;
}
```

äº§ç”Ÿçš„æ±‡ç¼–ä»£ç 

```asm
    movl    $0, %eax    # result = 0
.L2:                    # loop:
    movq    %rdi, %rdx
    andl    $1, %edx    # t = x & 0x1
    addq    %rdx, %rax  # result += t
    shrq    %rdi        # x >>= 1
    jne     .L2         # if (x) goto loop
    rep                 # ret
```

##### for

for å¾ªç¯çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š

```c
for (init-expr; test-expr; update-expr)
    body-statement
```

#### swich

swich å¾ªç¯çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š

```c
swich(n){
    case test-expr:
        body-statement
        break;
    case test-expr:
        body-statement
        break;
}

```

å¯¹äºCè¯­è¨€çš„è¿™äº›è¯­æ³•æˆ‘åªæ˜¯åœ¨è¿™é‡Œä¸¾å‡ºä¾‹å­æ¥ï¼Œæœ€å¥½çœ‹çœ‹ä¹¦ä¸Šçš„è®²è§£ã€‚
### åˆ†æ”¯è·³è½¬(RISC-V)

å¯¹äºè¿™ä¸ªåˆ†ç±»å…¶å®æˆ‘åˆ†ç»™äº†RISC-Vï¼Œ ä¸»è¦æ˜¯åœ¨x86-64ä¸­çš„æ§åˆ¶æŒ‡ä»¤å’ŒRISC-Vçš„åˆ†æ”¯è·³è½¬å…¶å®æ˜¯ä¸€å›äº‹ï¼Œä¸»è¦åŒºåˆ«æ˜¯å¦ä½¿ç”¨çš„æ¡ä»¶ç ï¼ˆå…¶å®åœ¨æˆ‘çœ‹æ¥RISC-Vä¹Ÿç”¨äº†æ¡ä»¶ç ï¼Œä½†æ˜¯æ˜¯éšå¼çš„ä½¿ç”¨ï¼‰ã€‚

RISC-Vçš„ **Branch Instruction**

```asm
ï¼ˆæ–½å·¥ä¸­ğŸš§ï¼‰
```

## è¿‡ç¨‹è°ƒç”¨

è¿‡ç¨‹æ˜¯è½¯ä»¶ä¸­ä¸€ç§å¾ˆé‡è¦çš„æŠ½è±¡ã€‚å®ƒæä¾›äº†ä¸€ç§å°è£…ä»£ç çš„æ–¹å¼ï¼Œç”¨ä¸€ç»„æŒ‡å®šçš„å‚æ•°å’Œä¸€ä¸ªå¯é€‰çš„è¿”å›å€¼å®ç°äº†æŸç§åŠŸèƒ½ã€‚ç„¶åï¼Œå¯ä»¥åœ¨ç¨‹åºä¸­ä¸åŒçš„åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è®¾è®¡è‰¯å¥½çš„è½¯ä»¶ç”¨è¿‡ç¨‹ä½œä¸ºæŠ½è±¡æœºåˆ¶ï¼Œéšè—æŸä¸ªè¡Œä¸ºçš„å…·ä½“å®ç°ï¼ŒåŒæ—¶åˆæä¾›æ¸…æ™°ç®€æ´çš„æ¥å£å®šä¹‰ï¼Œè¯´æ˜è¦è®¡ç®—çš„æ˜¯å“ªäº›å€¼ï¼Œè¿‡ç¨‹ä¼šå¯¹ç¨‹åºçŠ¶æ€äº§ç”Ÿä»€ä¹ˆæ ·çš„å½±å“ã€‚ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¿‡ç¨‹çš„å½¢å¼å¤šæ ·ï¼šå‡½æ•°(function) ã€æ–¹æ³•(method) ã€å­ä¾‹(subroutine) ã€å¤„ç†å‡½æ•°(handler) ç­‰ç­‰ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›å…±æœ‰çš„ç‰¹æ€§ã€‚

è¿‡ç¨‹è°ƒç”¨ä¸»è¦æœ‰ä¸‰ä¸ªæœºåˆ¶ï¼š

1. **æ§åˆ¶ä¼ é€’**ã€‚åŒ…æ‹¬å¦‚ä½•å¼€å§‹æ‰§è¡Œè¿‡ç¨‹ä»£ç ï¼Œä»¥åŠå¦‚ä½•è¿”å›åˆ°å¼€å§‹çš„åœ°æ–¹ã€‚æœ¬è´¨ä¸Šæ˜¯ä»£ç æ‰§è¡Œåœ°å€çš„æ”¹å˜å’Œåˆ‡æ¢ã€‚

2. **æ•°æ®ä¼ é€’**ã€‚è°ƒç”¨å‡½æ•°æ—¶è¦ä¼ ç»™å‡½æ•°ä¸€äº›å‚æ•°ï¼Œåœ¨è¿”å›å‡½æ•°æ—¶ä¹Ÿå¯èƒ½ä¼šå°†ä¸€äº›å‡½æ•°è®¡ç®—ç»“æœä»¥è¿”å›å€¼å½¢å¼è¿”å›ç»™åŸå‡½æ•°ã€‚æœ¬è´¨ä¸Šæ˜¯æ•°æ®ä¼ å…¥æ–°è¿‡ç¨‹ï¼Œåˆä¼ å›åŸè¿‡ç¨‹ã€‚

3. **å†…å­˜ç®¡ç†**ã€‚åœ¨è¿‡ç¨‹è¿›è¡Œæ—¶ï¼Œå¦‚ä½•åˆ†é…å†…å­˜ç©ºé—´ï¼›åœ¨è¿‡ç¨‹è¿”å›åï¼Œå¦‚ä½•é”€æ¯å†…å­˜ä¸­å­˜å‚¨çš„å±€éƒ¨å˜é‡ã€‚

![callsk](https://s2.loli.net/2023/05/07/iWSVILyRpxh63Dl.jpg)

## æ•°æ®å­˜å‚¨åˆ†é…

## å¤–éƒ¨é“¾æ¥

[æ‘©å°”å®šå¾‹---Wiki](https://zh.wikipedia.org/wiki/%E6%91%A9%E5%B0%94%E5%AE%9A%E5%BE%8B)

[å¾®å¤„ç†å™¨---Wiki](https://zh.wikipedia.org/wiki/%E5%BE%AE%E5%A4%84%E7%90%86%E5%99%A8)

[*The 50 Year History of the Microprocessor*](https://zhuanlan.zhihu.com/p/511271401)

[èŠ¯ç‰‡ç›¸å…³-- Cpuå†å²--AMDç³»åˆ—](https://zhuanlan.zhihu.com/p/464721330)

[èŠ¯ç‰‡ç›¸å…³-- Cpuå†å²--intelç³»åˆ—](https://zhuanlan.zhihu.com/p/464413953)

[ã€è¯»è–„ CSAPPã€‘è´° æœºå™¨æŒ‡ä»¤ä¸ç¨‹åºä¼˜åŒ–](https://wdxtub.com/csapp/thin-csapp-2/2016/04/16/)

[RISC-Væ‰‹å†Œ](http://riscvbook.com/chinese/RISC-V-Reader-Chinese-v2p1.pdf)

[RISC-VåŸºæœ¬æŒ‡ä»¤é›†æ¦‚è¿°](https://www.sunnychen.top/archives/riscvbasic)

[è¿‡ç¨‹è°ƒç”¨](https://segmentfault.com/a/1190000022161796)
